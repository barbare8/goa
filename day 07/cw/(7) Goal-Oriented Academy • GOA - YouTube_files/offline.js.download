(function(g){var window=this;'use strict';var PjL=function(l){var c=new g.k8("und",new g.ys("Default","und",!0));c.captionTracks=l.captionTracks;return c},bRN=function(l){return new g.va(function(c,Y){var X=l.length,k=[];
if(X)for(var r=function(O,D){X--;k[O]=D;X==0&&c(k)},e=function(O){Y(O)},d,y=0;y<l.length;y++)d=l[y],g.LwS(d,g.In(r,y),e);
else c(k)})},oK=function(l){this.D=l},CT=function(){oK.apply(this,arguments)},qUQ=function(){CT.apply(this,arguments)},arQ=function(){CT.apply(this,arguments)},N0a=function(){CT.apply(this,arguments)},pMQ=function(){CT.apply(this,arguments)},Raa=function(){CT.apply(this,arguments)},iRV=function(){CT.apply(this,arguments)},SUU=function(){oK.apply(this,arguments)},vkN=function(){CT.apply(this,arguments)},x6N=function(){CT.apply(this,arguments)},zaE=function(){CT.apply(this,arguments)},nkM=function(){CT.apply(this,
arguments)},haN=function(){CT.apply(this,arguments)},HRM=function(){CT.apply(this,arguments)},wMa=function(){CT.apply(this,arguments)},KDi=function(){CT.apply(this,arguments)},T0L=function(){CT.apply(this,arguments)},jpE=function(){CT.apply(this,arguments)},VHQ=function(){CT.apply(this,arguments)},ok6=function(){CT.apply(this,arguments)},Cj6=function(){oK.apply(this,arguments)},ZRQ=function(){CT.apply(this,arguments)},$6c=function(){CT.apply(this,arguments)},QpL=function(){CT.apply(this,arguments)},
m6N=function(){CT.apply(this,arguments)},WDU=function(){CT.apply(this,arguments)},MHV=function(){CT.apply(this,arguments)},spL=function(){CT.apply(this,arguments)},B07=function(){CT.apply(this,arguments)},LDV=function(){CT.apply(this,arguments)},EkF=function(){oK.apply(this,arguments)},gkQ=function(){oK.apply(this,arguments)},u2V=function(){oK.apply(this,arguments)},AYQ=function(){CT.apply(this,arguments)},FDe=function(){CT.apply(this,arguments)},Ire=function(){CT.apply(this,arguments)},lBM=function(){CT.apply(this,
arguments)},csM=function(){CT.apply(this,arguments)},YE7=function(){CT.apply(this,arguments)},XLa=function(){CT.apply(this,arguments)},kiN=function(){CT.apply(this,arguments)},rsN=function(){CT.apply(this,arguments)},eTc=function(){CT.apply(this,arguments)},Js7=function(){CT.apply(this,arguments)},dti=function(){CT.apply(this,arguments)},ysQ=function(){CT.apply(this,arguments)},OI7=function(){CT.apply(this,arguments)},DtU=function(){CT.apply(this,arguments)},t2c=function(){CT.apply(this,arguments)},
UtQ=function(){CT.apply(this,arguments)},GiQ=function(){CT.apply(this,arguments)},fBL=function(){CT.apply(this,arguments)},PRe=function(){CT.apply(this,arguments)},bIL=function(){CT.apply(this,arguments)},qEQ=function(){CT.apply(this,arguments)},aBa=function(){CT.apply(this,arguments)},Nrc=function(){CT.apply(this,arguments)},pL7=function(){CT.apply(this,arguments)},RTc=function(){CT.apply(this,arguments)},iIF=function(){oK.apply(this,arguments)},SEN=function(){CT.apply(this,arguments)},vRN=function(){CT.apply(this,
arguments)},xtQ=function(){CT.apply(this,arguments)},zT7=function(){CT.apply(this,arguments)},nRF=function(){CT.apply(this,arguments)},hTa=function(){CT.apply(this,arguments)},HIa=function(){CT.apply(this,arguments)},wLL=function(){CT.apply(this,arguments)},KIi=function(){CT.apply(this,arguments)},TrN=function(){CT.apply(this,arguments)},jMc=function(){CT.apply(this,arguments)},V2Q=function(){CT.apply(this,arguments)},oRF=function(){CT.apply(this,arguments)},CRE=function(){CT.apply(this,arguments)},
ZIV=function(){CT.apply(this,arguments)},$tQ=function(){CT.apply(this,arguments)},QML=function(){CT.apply(this,arguments)},mtQ=function(){CT.apply(this,arguments)},WIQ=function(){CT.apply(this,arguments)},M2a=function(){CT.apply(this,arguments)},sM6=function(){CT.apply(this,arguments)},Brc=function(){CT.apply(this,arguments)},LIU=function(){CT.apply(this,arguments)},ERa=function(){CT.apply(this,arguments)},gRe=function(){CT.apply(this,arguments)},usa=function(){CT.apply(this,arguments)},AsL=function(){CT.apply(this,
arguments)},FIi=function(){CT.apply(this,arguments)},IBN=function(){CT.apply(this,arguments)},lDQ=function(){CT.apply(this,arguments)},czQ=function(){CT.apply(this,arguments)},YsQ=function(){CT.apply(this,arguments)},Xq6=function(l){l=l.key||l.id;
if(!l)throw Error("Entity key is missing");return l},kY7=function(){if(Z2)return Z2();
var l={};Z2=g.Yq("PersistentEntityStoreDb",{dF:(l.EntityStore={qG:1},l.EntityAssociationStore={qG:2},l),shared:!1,upgrade:function(c,Y){Y(1)&&g.Cb(g.wO(c,"EntityStore",{keyPath:"key"}),"entityType","entityType");Y(2)&&(c=g.wO(c,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Cb(c,"byParentEntityKey","parentEntityKey"),g.Cb(c,"byChildEntityKey","childEntityKey"))},
version:3});return Z2()},rzN=function(l){return g.BH(kY7(),l)},e6N=function(l){return g.BH((0,g.EXc)(),l)},$d=function(l){this.token=l},Q2=function(l,c){c=c===void 0?{}:c;
g.Ed.call(this,g.gXL[l],Object.assign({},{name:"PESEncoderError",type:l},c));this.type=l;this.level="WARNING";Object.setPrototypeOf(this,Q2.prototype)},JzU=function(l){return new Q2("WRONG_DATA_TYPE",{cE:l})},deQ=function(l){return l instanceof Error?new Q2("UNKNOWN_ENCODE_ERROR",{Hw:l.message}):new Q2("UNKNOWN_ENCODE_ERROR")},yze=function(l){return l instanceof Error?new Q2("UNKNOWN_DECODE_ERROR",{Hw:l.message}):new Q2("UNKNOWN_DECODE_ERROR")},OfF=function(l,c){l=l instanceof Q2?l:c(l);
g.ot(l);throw l;},Dee=function(){},ttN=function(l,c,Y){try{return l.K(c,Y)}catch(X){OfF(X,deQ)}},Ue7=function(l){l=(new TextEncoder).encode(l).subarray(0,16);
var c=new Uint8Array(16);c.set(l);return c},mO=function(l){this.D=l},fDN=function(l){var c=GYi[l];
if(c)return c;g.Cj(new g.Ed("Entity model not found.",{entityType:l}))},PeQ=function(l,c){this.D=l;
this.G=c;this.K={}},qsL=function(l,c){a:{l=bfQ(l.G,c.version);
try{var Y=l.G(c.data,c.key);break a}catch(X){OfF(X,yze)}Y=void 0}return Y},W$=function(l,c,Y){return l.D.objectStore("EntityStore").get(c).then(function(X){if(X){if(Y&&X.entityType!==Y)throw Error("Incorrect entity type");
return qsL(l,X)}})},Mv=function(l,c,Y){return Y?(Y=Y.map(function(X){return W$(l,X,c)}),g.SI.all(Y)):l.D.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(c)).then(function(X){return X.map(function(k){return qsL(l,k)})})},B$=function(l,c,Y){var X=Xq6(c),k=bfQ(l.G,1),r=Object.assign({},c);
return l.D.objectStore("EntityStore").get(X).then(function(e){if(e){if(e.entityType!==Y)throw Error("Incorrect entity type");r.entityMetadata||(e=qsL(l,e),r.entityMetadata=e.entityMetadata)}}).then(function(){var e={key:X,
entityType:Y,data:ttN(k,r,X),version:1};return g.SI.all([g.jI(l.D.objectStore("EntityStore"),e),aDL(l,r,Y)])}).then(function(){sk(l,X,Y);
return X})},NgN=function(l,c,Y){c=c.map(function(X){return B$(l,X,Y)});
return g.SI.all(c)},LT=function(l,c,Y){if(Y==null?0:Y.Iz){var X=new Set;
return pqF(l,c,X).then(function(){for(var r=[],e=g.b(X),d=e.next();!d.done;d=e.next())r.push(LT(l,d.value));return g.SI.all(r).then(function(){})})}var k=g.FN(c).entityType;
return g.SI.all([l.D.objectStore("EntityStore").delete(c),R6Q(l,c)]).then(function(){sk(l,c,k)})},ifU=function(l,c){return g.mp(l.D.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(c)},function(Y){return g.SI.all([Y.delete(),
R6Q(l,Y.cursor.primaryKey)]).then(function(){sk(l,Y.cursor.primaryKey,c);return g.$l(Y)})})},SsV=function(l,c,Y,X){var k=bfQ(l.G,1);
return W$(l,c,X).then(function(r){if(r){r=g.qz(r,Y);var e={key:c,entityType:X,data:ttN(k,r,c),version:1};return g.SI.all([g.jI(l.D.objectStore("EntityStore"),e),aDL(l,r,X)])}}).then(function(){sk(l,c,X);
return c})},sk=function(l,c,Y){var X=l.K[Y];
X||(X=new Set,l.K[Y]=X);X.add(c)},vKe=function(l,c,Y){var X=Xq6(c);
Y=fDN(Y);if(!Y)return g.SI.resolve([]);Y=new Y(c);l=l.D.objectStore("EntityAssociationStore");c=[];Y=g.b(Y.G());for(var k=Y.next();!k.done;k=Y.next())c.push(g.jI(l,{parentEntityKey:X,childEntityKey:k.value}));return g.SI.all(c).then(function(r){return r.map(function(e){return e[1]})})},R6Q=function(l,c){return l.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(c))},aDL=function(l,c,Y){var X=Xq6(c);
return R6Q(l,X).then(function(){return vKe(l,c,Y)})},pqF=function(l,c,Y){if(Y.has(c))return g.SI.resolve(void 0);
Y.add(c);return xeM(l,c).then(function(X){return l.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(c)).then(function(){return X})}).then(function(X){var k=g.SI.resolve(void 0);
X=g.b(X);for(var r=X.next(),e={};!r.done;e={W1:void 0},r=X.next())e.W1=r.value,k=k.then(function(d){return function(){return pqF(l,d.W1,Y)}}(e));
return k}).then(function(){})},xeM=function(l,c){var Y=l.D.objectStore("EntityAssociationStore");
return Y.index("byParentEntityKey").getAll(IDBKeyRange.only(c)).then(function(X){var k=[];X=g.b(X);for(var r=X.next();!r.done;r=X.next())r=r.value,k.push(Y.index("byChildEntityKey").getAll(r.childEntityKey));return g.SI.all(k)}).then(function(X){var k=[];
X=g.b(X);for(var r=X.next();!r.done;r=X.next())r=r.value,r.length===1&&k.push(r[0].childEntityKey);return k})},Ek=function(){},z6N=function(){this.D={};
this.D[0]=new Ek;if(!g.pg("aes_pes_encoder_killswitch")){var l=this.D;try{var c=g.gF();var Y=Ue7(c);var X=new mO(new g.vv(Y),new g.SV(Y))}catch(k){throw l=k instanceof Error?new Q2("KEY_CREATION_FAILED",{Hw:k.message}):new Q2("KEY_CREATION_FAILED"),g.ot(l),l;}l[1]=X}},bfQ=function(l,c){c=c===void 0?0:c;
l=l.D[c];if(!l)throw c=new Q2("INVALID_ENCODER_VERSION",{cE:c}),g.ot(c),c;return l},gc=function(l,c){g.C.call(this);
this.token=l;this.D=c;this.observers=[];l=new g.Qn.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.gF());l.onmessage=this.G.bind(this);this.channel=l},uK=function(l,c,Y){var X,k,r,e;
return g.H(function(d){if(d.D==1)return g.n(d,rzN(l.token),2);if(d.D!=3)return X=d.G,g.n(d,g.TP(X,["EntityStore","EntityAssociationStore"],c,function(y){k=new PeQ(y,l.D);return Y(k)}),3);
r=d.G;k&&(e=k.K,Object.keys(e).length>0&&(l.channel.postMessage(e),nKN(l,e)));return d.return(r)})},AK=function(l,c,Y){return uK(l,{mode:"readwrite",
b9:!0},function(X){return B$(X,c,Y)})},h6Q=function(l,c){return uK(l,{mode:"readwrite",
b9:!0},function(Y){return NgN(Y,c,"offlineOrchestrationActionWrapperEntity")})},HfQ=function(l,c){return uK(l,{mode:"readwrite",
b9:!0},function(Y){return LT(Y,c)})},wqQ=function(l){return uK(l,{mode:"readwrite",
b9:!0},function(c){return ifU(c,"videoPlaybackPositionEntity")})},FV=function(l,c,Y){return uK(l,{mode:"readonly",
b9:!0},function(X){return W$(X,c,Y)})},IK=function(l,c,Y){return uK(l,{mode:"readonly",
b9:!0},function(X){return Mv(X,c,Y)})},nKN=function(l,c){l=g.b(l.observers);
for(var Y=l.next();!Y.done;Y=l.next())Y=Y.value,Y(c)},KzU=function(){var l,c,Y;
return g.H(function(X){if(X.D==1)return g.Rn(X,2),g.n(X,g.l1(),4);if(X.D!=2){l=X.G;if(!l||!g.u3()||typeof g.Qn.BroadcastChannel==="undefined")return X.return();c=new z6N;return X.return(new gc(l,c))}Y=g.vS(X);Y instanceof Error&&g.ot(Y);return X.return()})},lD=function(){TgE||(TgE=KzU());
return TgE},jkc=function(l){var c;
l=(c=l.options)==null?void 0:c.persistenceOption;return l==="ENTITY_PERSISTENCE_OPTION_PERSIST"||l==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},VtN=function(l){var c;
return g.H(function(Y){return Y.D==1?g.n(Y,lD(),2):(c=Y.G)?g.n(Y,uK(c,"readwrite",function(X){for(var k={},r=g.b(l),e=r.next(),d={};!e.done;d={i5:void 0,ji:void 0},e=r.next())d.i5=e.value,d.i5.entityKey&&jkc(d.i5)&&(d.ji=g.hd(d.i5.payload),e=void 0,d.i5.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(e=function(y){return function(){return B$(X,y.i5.payload[y.ji],y.ji)}}(d)),d.i5.type==="ENTITY_MUTATION_TYPE_DELETE"&&(e=function(y){return function(){return LT(X,y.i5.entityKey)}}(d)),d.i5.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(e=function(y){return function(){return SsV(X,y.i5.entityKey,y.i5.payload[y.ji],y.ji)}}(d)),e&&(k[d.i5.entityKey]=k[d.i5.entityKey]?k[d.i5.entityKey].then(e):e()));
return g.SI.all(Object.values(k))}),0):Y.return()})},oKN=function(l){var c;
return g.H(function(Y){if(Y.D==1){c=l.mutations;if(!c||c.length<=0)return Y.return();if(g.Xu){var X={type:"ENTITY_LOADED"};c!==void 0&&(X.payload=c);g.Xu.dispatch(X)}return g.n(Y,VtN(c),2)}c.length=0;g.pL(Y)})},CeL=function(l){return l!==void 0},ZfN=function(l){var c=g.ht();
c=Object.assign({},c);l=Object.assign({},l);for(var Y in c)l[Y]?(c[Y]!==4&&(c[Y]=l[Y]),delete l[Y]):c[Y]!==2&&(c[Y]=4);Object.assign(c,l);g.FLi(c);JSON.stringify(c);return c},$eL=function(l){var c,Y;
return g.H(function(X){if(X.D==1)return g.n(X,g.l1(),2);if(X.D!=3)return(c=X.G)?g.n(X,g.Ku(c),3):X.return();Y=X.G;return X.return(g.TP(Y,["index","media","captions"],{mode:"readwrite",b9:!0},function(k){var r=IDBKeyRange.bound(l+"|",l+"~");k=[k.objectStore("index").delete(r),k.objectStore("media").delete(r),k.objectStore("captions").delete(r)];return g.SI.all(k).then(function(){})}))})},Qke=function(){var l,c;
return g.H(function(Y){if(Y.D==1)return g.n(Y,g.l1(),2);if(Y.D!=3){l=Y.G;if(!l)throw g.Rf("rvdfd");return g.n(Y,g.Ku(l),3)}c=Y.G;return Y.return(g.TP(c,["index","media"],{mode:"readwrite",b9:!0},function(X){var k={};return g.Zn(X.objectStore("index"),{},function(r){var e=r.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),d=g.SI.resolve(void 0);if(e){var y=e[1];e=e[2];k[y]=k[y]||{};var O;k[y][e]=g.Xjc((O=r.getValue())==null?void 0:O.fmts)}else d=r.delete().then(function(){});
return g.SI.all([g.$l(r),d]).then(function(D){return g.b(D).next().value})}).then(function(){for(var r={},e=g.b(Object.keys(k)),d=e.next();!d.done;d=e.next()){d=d.value;
var y=k[d].v;r[d]=k[d].a&&y?1:2}var O=ZfN(r);return g.zOV(X.objectStore("media"),{},function(D){var t=D.cursor.key.match(g.J4y);t&&r[t[1]]||X.objectStore("media").delete(D.cursor.key);return g.qDK(D)}).then(function(){return O})})}))})},meL=function(l,c){var Y,X;
return g.H(function(k){if(k.D==1)return g.n(k,g.l1(),2);if(k.D!=3){Y=k.G;if(!Y)throw g.Rf("wct");return g.n(k,g.Ku(Y),3)}X=k.G;return g.n(k,g.TP(X,["captions"],{mode:"readwrite",b9:!0},function(r){var e=[];r=r.objectStore("captions");for(var d=0;d<c.length;d++){var y=g.jI(r,c[d],l+"|"+c[d].metadata.vss_id);e.push(y)}return g.SI.all(e)}),0)})},Wze=function(l){var c,Y,X;
return g.H(function(k){if(k.D==1)return c=IDBKeyRange.bound(l+"|",l+"~"),g.n(k,g.l1(),2);if(k.D!=3){Y=k.G;if(!Y)throw g.Rf("gactfv");return g.n(k,g.Ku(Y),3)}X=k.G;return k.return(X.getAll("captions",c))})},Mti=function(l){return g.H(function(c){g.wa(l,0);
return c.return($eL(l))})},skN=function(l){return{context:g.Fz(),
videoIds:l}},BgM=function(l){return{context:g.Fz(),
playlistIds:l}},LzN=function(l){return{context:g.Fz(),
offlinePlaylistSyncChecks:l}},EKU=function(){this.D=new Map},u4e=function(){gKF||(gKF=new EKU);
return gKF},Aza=function(l,c){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:l},metadata:c,statusCode:void 0,csn:void 0,can:void 0}},FzM=function(l,c,Y){if(!Y){var X=X===void 0?!1:X;
Y=l.D.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Y||X)Y=g.vw(16),l.D.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Y)}l={flowNonce:Y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:c.eventType};c.metadata&&(l.flowMetadata=c.metadata);c.statusCode!==void 0&&(l.flowEventStatus=c.statusCode);c.csn&&(l.csn=c.csn);c.can&&(l.can=c.can);g.Oq("flowEvent",l,void 0)},IDc=function(l){var c,Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN,R,v,z;
return g.H(function(w){if(w.D==1)return g.n(w,uK(l,{mode:"readonly",b9:!0},function(V){return Mv(V,"playbackData").then(function(cS){var ry=cS.map(function(bc){return bc.transfer}).filter(function(bc){return!!bc}),ei=cS.map(function(bc){return bc.offlineVideoPolicy}).filter(function(bc){return!!bc}),T=cS.filter(function(bc){return!!bc.key}).map(function(bc){return g.I5(g.FN(bc.key).entityId,"downloadStatusEntity")});
ry=Mv(V,"transfer",ry);ei=Mv(V,"offlineVideoPolicy",ei);T=Mv(V,"downloadStatusEntity",T);var D5=ry.then(function(bc){bc=bc.reduce(function(yn,KL){(KL==null?0:KL.offlineVideoStreams)&&yn.push.apply(yn,g.N(KL.offlineVideoStreams));return yn},[]).filter(function(yn){return!!yn});
return Mv(V,"offlineVideoStreams",bc)});
return g.SI.all([ry,ei,D5,T]).then(function(bc){var yn=g.b(bc);bc=yn.next().value;var KL=yn.next().value;var bQ=yn.next().value;yn=yn.next().value;return[cS,bc,KL,bQ,yn]})})}),2);
if(w.D!=3)return c=w.G,g.n(w,uK(l,{mode:"readonly",b9:!0},function(V){return Mv(V,"mainDownloadsListEntity").then(function(cS){var ry,ei;return(ei=(ry=cS[0])==null?void 0:ry.downloads)!=null?ei:[]})}),3);
Y=w.G;X=g.b(c);k=X.next().value;r=X.next().value;e=X.next().value;d=X.next().value;y=X.next().value;O=k;D=r;t=e;U=d;G=y;f={};a={};p={};S={};x={};h=[];K=g.b(D);for(Q=K.next();!Q.done;Q=K.next())(lc=Q.value)&&(f[lc.key]=lc);E=g.b(t);for(kv=E.next();!kv.done;kv=E.next())(Jg=kv.value)&&(a[Jg.key]=Jg);I=g.b(G);for(W=I.next();!W.done;W=I.next())(F=W.value)&&(p[F.key]=F);q=g.b(U);for(M=q.next();!M.done;M=q.next())(mK=M.value)&&(S[mK.key]=mK);SL=g.b(Y);for(PV=SL.next();!PV.done;PV=SL.next())zO=PV.value,lQ=
void 0,x[(lQ=zO.videoItem)!=null?lQ:""]=!0,zO.videoItem&&(qN=JE=void 0,R=(qN=(JE=g.FN(zO.videoItem))==null?void 0:JE.entityId)!=null?qN:"",h.push({externalVideoId:R}));v=O.filter(function(V){if(!V||!V.key||!V.offlineVideoPolicy)return!1;V=g.FN(V.key).entityId;V=g.I5(V,"downloadStatusEntity");var cS;return!(V&&((cS=p[V])==null?void 0:cS.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
z=v.map(function(V){var cS=f[V.transfer],ry=[];if(cS==null?0:cS.offlineVideoStreams)for(var ei=g.b(cS.offlineVideoStreams),T=ei.next();!T.done;T=ei.next())(T=S[T.value])&&ry.push(T);ei=a[V.offlineVideoPolicy];T=x;var D5=V==null?void 0:V.playerResponseTimestamp,bc=g.FN(ei.key).entityId;V=g.I5(bc,"mainVideoEntity");if(ei.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var yn="OFFLINE_VIDEO_STATE_DISABLED";ei.expirationTimestamp&&Number(ei.expirationTimestamp)<Date.now()/1E3&&(yn="OFFLINE_VIDEO_STATE_EXPIRED")}else if(ei.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")yn="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(cS==null?void 0:cS.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":yn="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":yn="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":yn="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":yn="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":yn="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":yn="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:yn="OFFLINE_VIDEO_STATE_UNKNOWN"}if(yn==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(cS==null?void 0:cS.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":yn="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":yn="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":yn=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}bc={id:bc,videoState:yn};if(cS==null?0:cS.cotn)bc.cotn=cS.cotn;if(cS==null?0:cS.maximumDownloadQuality)bc.selectedVideoQuality=cS==null?void 0:cS.maximumDownloadQuality;if(cS==null?0:cS.lastProgressTimeMs)bc.lastProgressTimeMs=cS.lastProgressTimeMs;D5&&(bc.playerResponseSavedTimeMs=String(Number(D5)*1E3));cS=String;D5=0;ry=g.b(ry);for(yn=ry.next();!yn.done;yn=ry.next())if(yn=yn.value,yn.streamsProgress){yn=g.b(yn.streamsProgress);for(var KL=yn.next();!KL.done;KL=
yn.next()){var bQ=void 0;D5+=Number((bQ=KL.value.numBytesDownloaded)!=null?bQ:0)}}bc.downloadedBytes=cS(D5);bc.selectedOfflineMode=T[V]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";ei.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(bc.offlinePlaybackDisabledReason=ei.offlinePlaybackDisabledReason);return bc});
return w.return({offlineVideos:z,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:h}}})})},lZE=function(){this.locks=navigator.locks},cT6=function(){try{var l=g.MX("ytglobal.locks_");
if(l)return l;var c;if(c=navigator){var Y=navigator;c="locks"in Y&&!!Y.locks}if(c)return g.Qn.localStorage&&g.Qn.localStorage.getItem("noop"),l=new lZE,g.WS("ytglobal.locks_",l),l}catch(X){}},ct=function(){},Y2a=function(){},XPE=function(l){if(l.includes(":"))throw Error("Invalid user cache name: "+l);
return l+":"+g.gF("CacheStorage get")},ksN=function(){return g.H(function(l){if(Yb!==void 0)return l.return(Yb);
Yb=new Promise(function(c){var Y;return g.H(function(X){switch(X.D){case 1:return g.Rn(X,2),g.n(X,XI.open("test-only"),4);case 4:return g.n(X,XI.delete("test-only"),5);case 5:g.Si(X,3);break;case 2:if(Y=g.vS(X),Y instanceof Error&&Y.name==="SecurityError")return c(!1),X.return();case 3:c("caches"in window),g.pL(X)}})});
return l.return(Yb)})},ejN=function(){return g.H(function(l){if(l.D==1)return g.n(l,ksN(),2);
if(!l.G)return l.return(void 0);rT7||(rT7=new Y2a);return l.return(rT7)})},kb=function(l,c,Y){g.Cj(new g.Ed("Woffle: "+l,Y?{cotn:Y}:""));
c instanceof Error&&g.Cj(c)},JTQ=function(l){var c;
return g.H(function(Y){if(Y.D==1)return g.n(Y,IDc(l),2);c=Y.G;g.Oq("offlineStateSnapshot",c);g.pL(Y)})},rd=function(l){g.C.call(this);
var c=this;this.api=l;this.gk={Q3A:function(){return c.D},
s3h:function(){return c.G}};
typeof g.Qn.BroadcastChannel!=="undefined"&&(this.D=new g.Qn.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.gF()),this.D.onmessage=this.K.bind(this),this.G=new g.Qn.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.gF()),this.G.onmessage=this.T.bind(this))},ew=function(l,c){l.api.cU("onOfflineOperationFailure",c);
var Y;(Y=l.D)==null||Y.postMessage(c)},dF7=function(l,c,Y,X){var k=this;
this.U=l;this.j=c;this.visibility=Y;this.B=X;this.N=this.C=this.W=this.K=this.D=!1;this.T=new g.gY(function(){k.fg()});
this.gk={Rq:function(){return k.G},
fg:function(){k.fg()},
qY0:function(){return k.T}};
this.visibility.subscribe("visibilitystatechange",function(){k.A5()})},yT6=function(l){if(!l.K&&!l.D){var c=cT6();
if(c){l.K=!0;var Y=g.gF("OfflineLockManager");c.request("woffle_orchestration_leader:"+Y,{},function(){var X,k,r,e;return g.H(function(d){switch(d.D){case 1:return g.Rn(d,2),l.G=new g.vb,l.D=!0,l.K=!1,g.n(d,l.U(),4);case 4:return g.n(d,l.G.promise,5);case 5:g.Si(d,0);break;case 2:X=g.vS(d),((r=(k=l).B)==null?0:r.call(k,"wo_relinquish_leadership_on_lock_request_error"))||l.fg(),X instanceof Error&&(e=X,e.args=[{name:"WoLockManagerError",ym:X.name}],g.ot(e)),g.pL(d)}})})}}},OOF=function(l){l.D&&(l.N=
!0,JI(l))},DFQ=function(l,c){l.D&&(l.W=c,JI(l))},tnM=function(l,c){l.D&&(l.C=c,JI(l))},JI=function(l){l.C&&l.W&&l.N&&l.visibility.isBackground()?g.uf(l.T,6E4):l.T.stop()},dd=function(l){var c;
l.offlineDeleteReason=(c=l.offlineDeleteReason)!=null?c:"OFFLINE_DELETE_REASON_UNKNOWN";var Y;l.offlineModeType=(Y=l.offlineModeType)!=null?Y:"OFFLINE_NOW";g.Oq("offlineDeleteEvent",l)},yL=function(l,c){var Y=c.videoId;
var X=c.kS;c=c.offlineModeType;l.encryptedVideoId=Y;l.cotn=X==null?void 0:X.cotn;l.offlineabilityFormatType=X==null?void 0:X.maximumDownloadQuality;var k;l.isRefresh=(k=X==null?void 0:X.isRefresh)!=null?k:!1;var r;l.softErrorCount=(r=X==null?void 0:X.transferRetryCount)!=null?r:0;l.offlineModeType=c!=null?c:"OFFLINE_NOW";(l.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&l.statusType==="UNKNOWN_STATUS_TYPE"||!l.transferStatusType&&!l.statusType)&&g.Cj(Error("Woffle unknown transfer status"));
g.Oq("offlineTransferStatusChanged",l)},UFc=function(l,c,Y,X){X={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!X};c&&Y&&(c=Math.floor(c/1024).toFixed(),Y=Math.floor(Y/1024).toFixed(),X.alreadyDownloadedKbytes=c,X.totalFetchedKbytes=c,X.totalContentKbytes=Y);yL(X,l)},GsL=function(l){yL({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},l)},fZe=function(l){switch(l){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
OF=function(l){var c,Y,X;
return((X=(c=l.actionMetadata)==null?void 0:(Y=c.retryScheduleIntervalsInSeconds)==null?void 0:Y.length)!=null?X:0)>0},Ds=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!l.entityKey},tI=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!l.entityKey},UF=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!l.entityKey},PAQ=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!l.entityKey},
Gr=function(l,c,Y,X,k){k=k===void 0?!1:k;
var r,e,d,y,O,D;return g.H(function(t){if(t.D==1)return r=g.I5(l,c),e=g.I5(l,"downloadStatusEntity"),g.n(t,uK(Y,{mode:"readonly",b9:!0},function(U){return g.SI.all([W$(U,r,c),W$(U,e,"downloadStatusEntity")])}),2);
d=t.G;y=d.length?d[0]:void 0;if(!y)return t.kT(0);O=bOU;if(D=d.length>1?d[1]:void 0){if(D.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!k)return t.return();D.downloadState=X}else D={key:e,downloadState:X};g.WR(y,O,D);return g.n(t,uK(Y,{mode:"readwrite",b9:!0},function(U){return g.SI.all([B$(U,y,c),B$(U,D,"downloadStatusEntity")])}),0)})},fd=function(l,c){return l.actionType===c.actionType&&l.entityKey===c.entityKey},Pt=function(l,c){if(l&&l.transferState!=="TRANSFER_STATE_COMPLETE"&&l.transferState!==
"TRANSFER_STATE_FAILED"){var Y=g.FN(l.key).entityId;
yL({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Y,kS:l,offlineModeType:c})}},bD=function(l){if(!l||!l.thumbnails)return[];
var c=[];l=g.b(l.thumbnails);for(var Y=l.next();!Y.done;Y=l.next())Y=Y.value,Y.url&&c.push(Y.url);return c},q2U=function(l,c,Y){Y=Y===void 0?[]:Y;
var X,k,r,e,d,y,O,D,t,U,G,f,a;return g.H(function(p){if(p.D==1)return Y.length?g.n(p,IK(l,c),2):p.return([]);X=p.G;k=new Set;r=g.b(X);for(e=r.next();!e.done;e=r.next())if(d=e.value,y=d.id||d.key)O=g.FN(y).entityId,k.add(O);D=[];t=g.b(Y);for(U=t.next();!U.done;U=t.next())G=U.value,f=G.offlineVideoData,a=void 0,((a=f)==null?0:a.videoId)&&!k.has(f.videoId)&&D.push(G);return p.return(D)})},aZQ=function(l,c,Y){return new g.sr(l,{cotn:c,
raw_player_response:Y,download_media:!0,start:Infinity,disable_watch_next:!0})},NnE=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},qY=function(l,c,Y,X,k,r,e,d,y,O,D){this.entityType=l;
this.actionId=c;this.action=Y;this.parentActionId=X;this.rootActionId=k===void 0?c:k;this.childActionIds=r;this.prereqActionId=e;this.postreqActionIds=d;this.hasChildActionFailed=O;this.retryScheduleIndex=0;this.D=D||Date.now();this.retryScheduleIndex=y||0},ar=function(l){if(!l.key)throw Error("Entity key is required.");
if(!l.actionProto)throw Error("OfflineOrchestrationAction is required.");var c=g.FN(l.key),Y=g.FN(l.actionProto.entityKey);return new qY(Y.entityType,c.entityId,l.actionProto,l.parentActionId,l.rootActionId,l.childActionIds,l.prereqActionId,l.postreqActionIds,l.retryScheduleIndex,l.hasChildActionFailed,Number(l.enqueueTimeSec)*1E3)},NY=function(l){return{key:g.I5(l.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:l.action,parentActionId:l.parentActionId,rootActionId:l.rootActionId,childActionIds:l.childActionIds,prereqActionId:l.prereqActionId,postreqActionIds:l.postreqActionIds,retryScheduleIndex:l.retryScheduleIndex,hasChildActionFailed:l.hasChildActionFailed,enqueueTimeSec:(l.D/1E3).toFixed()}},pP7=function(){var l;
return g.H(function(c){return c.D==1?g.n(c,ejN(),2):(l=c.G)?c.return(l.delete("yt-player-local-img")):c.return(!0)})},pd=function(l){var c,Y;
return g.H(function(X){if(X.D==1)return g.n(X,ejN(),2);if(X.D!=3){c=X.G;if(!c)throw Error("Cache API not supported");return l.length?g.n(X,c.open("yt-player-local-img"),3):X.return()}Y=X.G;return g.n(X,Promise.all(l.map(function(k){return Y.delete(k)})),0)})},Rr=function(l){var c,Y;
return g.H(function(X){if(X.D==1)return g.n(X,ejN(),2);if(X.D!=3){c=X.G;if(!c)throw Error("Cache API not supported");return l.length?g.n(X,c.open("yt-player-local-img"),3):X.return()}Y=X.G;return g.n(X,Y.addAll(l),0)})},iD=function(l,c,Y,X,k){var r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ;
return g.H(function(JE){switch(JE.D){case 1:return r=g.I5(l,"mainVideoEntity"),e=g.I5(l,"ytMainChannelEntity"),d=g.I5(l,"transfer"),y=g.I5(l,"videoDownloadContextEntity"),g.n(JE,uK(c,{mode:"readonly",b9:!0},function(qN){return g.SI.all([W$(qN,r,"mainVideoEntity"),W$(qN,e,"ytMainChannelEntity"),W$(qN,d,"transfer"),W$(qN,y,"videoDownloadContextEntity"),Mv(qN,"ytMainChannelEntity"),Mv(qN,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=JE.G;D=g.b(O);t=D.next().value;U=D.next().value;G=D.next().value;f=D.next().value;a=D.next().value;p=D.next().value;S=t;x=U;h=G;K=f;Q=a;lc=p;if(!S&&!x){JE.kT(3);break}E=S?bD(S.thumbnail):[];if(!x){kv=[];JE.kT(4);break}return g.n(JE,RjL(x,Q),5);case 5:kv=JE.G;case 4:return Jg=kv,g.n(JE,pd(E.concat(Jg)),3);case 3:I=[];W=g.I5(l,"downloadStatusEntity");F=g.b(lc);for(q=F.next();!q.done;q=F.next())M=q.value,mK=g.FN(M.key).entityId,SL=ar(M),PV=g.FN(SL.action.entityKey).entityId,mK!==l&&PV!==l||
fd(Y,M.actionProto)||I.push(M.key);return g.n(JE,uK(c,{mode:"readwrite",b9:!0},function(qN){var R=I.map(function(v){return LT(qN,v)});
R.push(LT(qN,r,{Iz:!0}));R.push(LT(qN,W,{Iz:!0}));return g.SI.all(R)}),7);
case 7:lQ=(zO=K)==null?void 0:zO.offlineModeType,k&&(dd(k),k.offlineModeType&&(lQ=k.offlineModeType)),Pt(h,lQ),ew(X,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pL(JE)}})},vHe=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN,R,v,z,w,V,cS,ry,ei,T,D5,bc,yn,KL,bQ,Q7,fU;
return g.H(function(LL){switch(LL.D){case 1:return k=g.I5(l,"mainPlaylistEntity"),r=g.I5(l,"ytMainChannelEntity"),g.n(LL,uK(c,{mode:"readonly",b9:!0},function(mJ){return g.SI.all([W$(mJ,k,"mainPlaylistEntity"),W$(mJ,r,"ytMainChannelEntity"),Mv(mJ,"mainPlaylistEntity"),Mv(mJ,"mainDownloadsListEntity"),Mv(mJ,"ytMainChannelEntity"),Mv(mJ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=LL.G;d=g.b(e);y=d.next().value;O=d.next().value;D=d.next().value;t=d.next().value;U=d.next().value;G=d.next().value;f=y;a=O;p=D;S=t;x=U;h=G;if(!f&&!a){LL.kT(3);break}K=f?iOi(f):[];if(!a){Q=[];LL.kT(4);break}return g.n(LL,RjL(a,x),5);case 5:Q=LL.G;case 4:return lc=Q,g.n(LL,pd(K.concat(lc)),3);case 3:E=[];kv=new Map;if(!f){LL.kT(7);break}return g.n(LL,S2e(f,p,S),8);case 8:E=LL.G;Jg=g.b(E);for(I=Jg.next();!I.done;I=Jg.next())W=I.value,kv.set(W,{videoId:W,playlistId:l,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.n(LL,uK(c,{mode:"readonly",b9:!0},function(mJ){return g.SI.all([Mv(mJ,"transfer"),Mv(mJ,"videoDownloadContextEntity")])}),9);
case 9:F=LL.G;q=g.b(F);M=q.next().value;mK=q.next().value;SL=M;PV=mK;zO=g.b(SL);for(lQ=zO.next();!lQ.done;lQ=zO.next())JE=lQ.value,qN=g.FN(JE.key).entityId,(R=kv.get(qN))&&JE&&(R.cotn=JE.cotn);v=g.b(PV);for(z=v.next();!z.done;z=v.next())w=z.value,V=g.FN(w.key).entityId,(cS=kv.get(V))&&w&&(cS.offlineModeType=w.offlineModeType);case 7:ry=[];ei=g.b(h);for(T=ei.next();!T.done;T=ei.next())D5=T.value,bc=g.FN(D5.key).entityId,yn=ar(D5),bc!==l&&yn.rootActionId!==l||fd(Y,D5.actionProto)||ry.push(D5.key);KL=
g.I5(l,"mainPlaylistEntity");return g.n(LL,uK(c,{mode:"readwrite",b9:!0},function(mJ){var Dy=ry.map(function(oa){return LT(mJ,oa)});
Dy.push(LT(mJ,KL,{Iz:!0}));return g.SI.all(Dy)}),10);
case 10:if(!f){LL.kT(0);break}E.reverse();if(!E){LL.kT(0);break}bQ=g.b(E);Q7=bQ.next();case 13:if(Q7.done){LL.kT(0);break}fU=Q7.value;return g.n(LL,iD(fU,c,Y,X,kv.get(fU)),14);case 14:Q7=bQ.next(),LL.kT(13)}})},zji=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U;
return g.H(function(G){if(G.D==1)return k=g.I5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),r=new Map,g.n(G,uK(l,{mode:"readwrite",b9:!0},function(f){var a=Mv(f,"transfer"),p=Mv(f,"offlineOrchestrationActionWrapperEntity"),S=Mv(f,"videoDownloadContextEntity"),x=W$(f,k,"mainDownloadsListEntity");return g.SI.all([a,p,S,x]).then(function(h){h=g.b(h);var K=h.next().value;var Q=h.next().value;var lc=h.next().value;var E=h.next().value;h=xFQ.map(function(Jg){return ifU(f,Jg)});
Q=g.b(Q);for(var kv=Q.next();!kv.done;kv=Q.next())kv=kv.value,fd(c,kv.actionProto)||h.push(LT(f,kv.key,{Iz:!0}));E&&(E.downloads=[],h.push(B$(f,E,"mainDownloadsListEntity")));if(lc)for(lc=g.b(lc),E=lc.next();!E.done;E=lc.next())E=E.value,Q=g.FN(E.key).entityId,Q=g.I5(Q,"transfer"),r.set(Q,E.offlineModeType);return g.SI.all(h).then(function(){return K})})}),2);
e=G.G;d=g.b(e);for(y=d.next();!y.done;y=d.next())O=y.value,Pt(O,r.get(O.key)),D=g.FN(O.key).entityId,t={videoId:D,offlineDeleteReason:X,cotn:O.cotn,offlineModeType:r.get(O.key)},dd(t),U=g.I5(D,"mainVideoEntity"),ew(Y,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.n(G,pP7(),0)})},iOi=function(l,c){var Y=[];
if(l.thumbnailStyleData){l=g.b(l.thumbnailStyleData);for(var X=l.next();!X.done;X=l.next()){var k=void 0,r=void 0,e=void 0;Y=Y.concat(bD((k=X.value)==null?void 0:(r=k.value)==null?void 0:(e=r.collageThumbnail)==null?void 0:e.coverThumbnail))}}c=bD(c);return Y.concat(c)},S2e=function(l,c,Y){var X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg;
return g.H(function(I){X=[];k=new Set;if(Y.length)for(r=g.b(Y),e=r.next();!e.done;e=r.next())if(d=e.value,y=void 0,(y=d.downloads)==null?0:y.length)for(O=g.b(d.downloads),D=O.next();!D.done;D=O.next())t=D.value,t.videoItem&&(U=g.FN(t.videoItem).entityId,k.add(U));if(l.videos){G=g.b(l.videos);for(f=G.next();!f.done;f=G.next())a=f.value,p=JSON.parse(g.FN(a).entityId),p.videoId&&!k.has(p.videoId)&&X.push(p.videoId);S=g.b(c);for(x=S.next();!x.done;x=S.next())if(h=x.value,h.key!==l.key&&(K=h.videos))for(Q=
g.b(K),lc=Q.next();!lc.done;lc=Q.next())E=lc.value,kv=JSON.parse(g.FN(E).entityId),kv.videoId&&(Jg=X.indexOf(kv.videoId),Jg!==-1&&X.splice(Jg,1))}return I.return(X)})},RjL=function(l,c){var Y,X,k,r,e,d,y,O;
return g.H(function(D){Y=bD(l.avatar);X=g.b(c);for(k=X.next();!k.done;k=X.next())if(r=k.value,r.id!==l.id)for(e=g.b(bD(r.avatar)),d=e.next();!d.done;d=e.next())y=d.value,O=Y.indexOf(y),O!==-1&&Y.splice(O,1);return D.return(Y)})},nHQ=function(l){var c;
return g.H(function(Y){c=g.m(l.frameworkUpdates,Sw);return l.frameworkUpdates&&c?g.n(Y,oKN(c),0):Y.return()})},HOM=function(l){var c;
if((c=l.onResponseReceivedActions)!=null&&c.length){var Y;l=(Y=g.m(g.m(l.onResponseReceivedActions[0],hjF),g.WJa))==null?void 0:Y.actions;if(l!=null&&l.length)return l}},wPi=function(l){var c,Y,X;
return g.H(function(k){if(k.D==1)return l?g.n(k,FV(l,g.KK,"mainDownloadsListEntity"),2):k.return([]);c=k.G;return((Y=c)==null?0:(X=Y.downloads)==null?0:X.length)?k.return(c.downloads.map(function(r){var e;return(e=r.videoItem)!=null?e:""})):k.return([])})},TnN=function(l,c){var Y;
return g.H(function(X){return X.D==1?g.n(X,K0M(l,c),2):(Y=X.G)?g.n(X,uK(l,{mode:"readwrite",b9:!0},function(k){var r=[B$(k,Y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Y.mainDownloadsListEntity&&r.push(B$(k,Y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.SI.all(r)}),0):X.kT(0)})},K0M=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h;
return g.H(function(K){if(K.D==1)return Y=g.I5("main_downloads_library_id","mainDownloadsLibraryEntity"),X=g.I5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.n(K,uK(l,{mode:"readonly",b9:!0},function(Q){return g.SI.all([W$(Q,Y,"mainDownloadsLibraryEntity"),W$(Q,X,"mainDownloadsListEntity")])}),2);
k=K.G;r=g.b(k);e=r.next().value;d=r.next().value;y=e;O=d;y||(y={id:Y});D=g.b(c);for(t=D.next();!t.done;t=D.next())if(U=t.value,U===g.KK){if(y.smartDownloadsList)return K.return();y.smartDownloadsList=U}else if(G=g.FN(U).entityType,f={},G==="mainPlaylistEntity"?f.playlistItem=U:G==="mainVideoEntity"&&(f.videoItem=U),!g.VS(f)){a=void 0;if((a=O)==null?0:a.downloads){p=!1;S=g.b(O.downloads);for(x=S.next();!x.done;x=S.next())if(h=x.value,h.playlistItem===U||h.videoItem===U){p=!0;break}p||O.downloads.push(f)}else O=
{id:X,downloads:[f]};y.downloadsList=X}return K.return({mainDownloadsLibraryEntity:y,mainDownloadsListEntity:O})})},j6Q=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p;
return g.H(function(S){if(S.D==1)return Y=g.I5("main_downloads_library_id","mainDownloadsLibraryEntity"),X=g.I5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.n(S,uK(l,{mode:"readonly",b9:!0},function(x){return g.SI.all([W$(x,Y,"mainDownloadsLibraryEntity"),W$(x,X,"mainDownloadsListEntity"),W$(x,g.KK,"mainDownloadsListEntity")])}),2);
k=S.G;r=g.b(k);e=r.next().value;d=r.next().value;y=r.next().value;O=e;D=d;t=y;if(!O)return S.kT(0);if(c===g.KK&&((U=t)==null?0:U.downloads))t.downloads=[];else if((G=D)==null?0:G.downloads)for(f=g.FN(c).entityType,a=0;a<D.downloads.length;a++)if(p=D.downloads[a],f==="mainVideoEntity"&&p.videoItem===c){D.downloads.splice(a,1);break}else if(f==="mainPlaylistEntity"&&p.playlistItem===c){D.downloads.splice(a,1);break}return g.n(S,uK(l,{mode:"readwrite",b9:!0},function(x){var h=[B$(x,O,"mainDownloadsLibraryEntity")];
D&&h.push(B$(x,D,"mainDownloadsListEntity"));t&&h.push(B$(x,t,"mainDownloadsListEntity"));return g.SI.all(h)}),0)})},vt=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U;
return g.H(function(G){if(G.D==1)return Y=g.I5(c,"transfer"),X=g.I5(c,"videoDownloadContextEntity"),g.n(G,uK(l,{mode:"readonly",b9:!0},function(f){return g.SI.all([W$(f,Y,"transfer"),W$(f,X,"videoDownloadContextEntity")])}),2);
k=G.G;r=g.b(k);e=r.next().value;d=r.next().value;y=e;O=d;U={videoId:c,cotn:(D=y)==null?void 0:D.cotn,offlineModeType:(t=O)==null?void 0:t.offlineModeType};return G.return(U)})},xb=function(l,c,Y,X,k){var r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv;
return g.H(function(Jg){switch(Jg.D){case 1:return r=g.I5(l,"musicTrack"),e=g.I5(l,"transfer"),g.n(Jg,uK(c,{mode:"readonly",b9:!0},function(I){return g.SI.all([W$(I,r,"musicTrack"),W$(I,e,"transfer"),Mv(I,"musicTrack"),Mv(I,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=Jg.G;y=g.b(d);O=y.next().value;D=y.next().value;t=y.next().value;U=y.next().value;G=O;f=D;a=t;p=U;if(!G){Jg.kT(3);break}return g.n(Jg,VnN(G,a),4);case 4:return S=Jg.G,g.n(Jg,pd(S),3);case 3:x=[];h=g.b(p);for(K=h.next();!K.done;K=h.next())Q=K.value,lc=g.FN(Q.key).entityId,E=ar(Q),kv=g.FN(E.action.entityKey).entityId,lc!==l&&kv!==l||fd(Y,Q.actionProto)||x.push(Q.key);return g.n(Jg,uK(c,{mode:"readwrite",b9:!0},function(I){var W=x.map(function(F){return LT(I,F)});
W.push(LT(I,r,{Iz:!0}));return g.SI.all(W)}),6);
case 6:Pt(f),k&&dd(k),ew(X,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pL(Jg)}})},zr=function(l,c,Y,X,k){var r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN,R,v,z;
return g.H(function(w){switch(w.D){case 1:return r=g.I5(l,c),e=g.I5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(w,uK(Y,{mode:"readonly",b9:!0},function(V){return g.SI.all([W$(V,r,c),W$(V,e,"musicDownloadsLibraryEntity"),Mv(V,c),Mv(V,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=w.G;y=g.b(d);O=y.next().value;D=y.next().value;t=y.next().value;U=y.next().value;G=O;f=D;a=t;p=U;if(!G){w.kT(3);break}return g.n(w,VnN(G,a),4);case 4:return S=w.G,g.n(w,pd(S),3);case 3:x=[];h=new Map;if(!G){w.kT(6);break}return g.n(w,oHV(G,a,f),7);case 7:x=w.G;K=g.b(x);for(Q=K.next();!Q.done;Q=K.next())lc=Q.value,E=g.FN(lc).entityId,h.set(E,{videoId:E,playlistId:l,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.n(w,IK(Y,"transfer"),8);case 8:for(kv=w.G,Jg=g.b(kv),
I=Jg.next();!I.done;I=Jg.next())W=I.value,F=g.FN(W.key).entityId,(q=h.get(F))&&W&&(q.cotn=W.cotn);case 6:M=[];mK=g.b(p);for(SL=mK.next();!SL.done;SL=mK.next())PV=SL.value,zO=g.FN(PV.key).entityId,lQ=ar(PV),zO!==l&&lQ.rootActionId!==l||fd(X,PV.actionProto)||M.push(PV.key);JE=g.I5(l,c);return g.n(w,uK(Y,{mode:"readwrite",b9:!0},function(V){var cS=M.map(function(ry){return LT(V,ry)});
cS.push(LT(V,JE,{Iz:!0}));return g.SI.all(cS)}),9);
case 9:if(!G){w.kT(0);break}x.reverse();if(!x.length){w.kT(0);break}qN=g.b(x);R=qN.next();case 12:if(R.done){w.kT(0);break}v=R.value;z=g.FN(v).entityId;if(!z){w.kT(13);break}return g.n(w,xb(z,Y,X,k,h.get(z)),13);case 13:R=qN.next(),w.kT(12)}})},nd=function(l,c,Y){var X,k,r,e,d,y,O;
return g.H(function(D){if(D.D==1)return g.n(D,uK(l,{mode:"readwrite",b9:!0},function(t){var U=Mv(t,"transfer"),G=Mv(t,"offlineOrchestrationActionWrapperEntity");return g.SI.all([U,G]).then(function(f){f=g.b(f);var a=f.next().value;var p=f.next().value;f=CAe.map(function(K){return ifU(t,K)});
p=g.b(p);for(var S=p.next();!S.done;S=p.next()){S=S.value;var x=g.FN(S.actionProto.entityKey).entityType==="musicTrack",h=S.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";fd(c,S.actionProto)||x&&(!x||h)||f.push(LT(t,S.key,{Iz:!0}))}return g.SI.all(f).then(function(){return a})})}),2);
X=D.G;k=g.b(X);for(r=k.next();!r.done;r=k.next())e=r.value,Pt(e),d=g.FN(e.key).entityId,y={videoId:d,offlineDeleteReason:void 0,cotn:e.cotn},dd(y),O=g.I5(d,"musicTrack"),ew(Y,{entityKey:O,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.n(D,pP7(),0)})},ZOi=function(l){for(var c,Y=g.b(l.additionalMetadatas),X=Y.next();!X.done;X=Y.next())X=X.value,X.offlineMusicVideoData&&(c=X.offlineMusicVideoData);
var k,r,e,d,y;return{id:g.I5(l.videoId,"musicTrack"),videoId:l.videoId,title:l.title,thumbnailDetails:l.thumbnail,lengthMs:String(Number(l.lengthSeconds)*1E3),albumTitle:(k=c)==null?void 0:k.releaseTitle,musicVideoType:(r=c)==null?void 0:r.musicVideoType,contentRating:{explicitType:(e=c)==null?void 0:e.explicitType},artistNames:((d=c)==null?void 0:d.byline)||((y=c)==null?void 0:y.channelName),downloadMetadata:g.I5(l.videoId,"musicTrackDownloadMetadataEntity")}},oHV=function(l,c,Y){var X,k,r,e,d,y,
O,D,t,U,G,f,a,p,S,x,h,K;
return g.H(function(Q){X=[];k=new Set;if((r=Y)==null?0:(e=r.downloadedTracks)==null?0:e.length)for(d=g.b(Y.downloadedTracks),y=d.next();!y.done;y=d.next())O=y.value,k.add(O);if(l.tracks){D=g.b(l.tracks);for(t=D.next();!t.done;t=D.next())U=t.value,k.has(U)||X.push(U);G=g.b(c);for(f=G.next();!f.done;f=G.next())if(a=f.value,a.id!==l.id&&(p=a.tracks))for(S=g.b(p),x=S.next();!x.done;x=S.next())h=x.value,K=X.indexOf(h),K!==-1&&X.splice(K,1)}return Q.return(X)})},VnN=function(l,c){var Y,X,k,r,e,d,y,O;
return g.H(function(D){Y=bD(l.thumbnailDetails);X=g.b(c);for(k=X.next();!k.done;k=X.next())if(r=k.value,r.id!==l.id)for(e=g.b(bD(r.thumbnailDetails)),d=e.next();!d.done;d=e.next())y=d.value,O=Y.indexOf(y),O!==-1&&Y.splice(O,1);return D.return(Y)})},$F6=function(l,c){var Y,X,k,r,e,d,y,O,D;
return g.H(function(t){if(t.D==1)return Y=g.I5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(t,FV(l,Y,"musicDownloadsLibraryEntity"),2);(X=t.G)||(X={id:Y});k=g.FN(c).entityType;k==="musicTrack"?(r=X.downloadedTracks)!=null&&r.includes(c)||(X.downloadedTracks=((e=X.downloadedTracks)!=null?e:[]).concat(c)):k==="musicPlaylist"?(d=X.downloadedPlaylists)!=null&&d.includes(c)||(X.downloadedPlaylists=((y=X.downloadedPlaylists)!=null?y:[]).concat(c)):k!=="musicAlbumRelease"||(O=X.downloadedAlbumReleases)!=
null&&O.includes(c)||(X.downloadedAlbumReleases=((D=X.downloadedAlbumReleases)!=null?D:[]).concat(c));return g.n(t,AK(l,X,"musicDownloadsLibraryEntity"),0)})},Q6a=function(l,c){var Y,X,k,r,e,d,y;
return g.H(function(O){if(O.D==1)return Y=g.I5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(O,FV(l,Y,"musicDownloadsLibraryEntity"),2);X=O.G;if(!X)return O.kT(0);k=g.FN(c).entityType;k==="musicTrack"?r=X.downloadedTracks:k==="musicPlaylist"&&(r=X.downloadedPlaylists);if((e=r)==null?0:e.length)for(d=0;d<r.length;d++)if(y=r[d],y===c){r.splice(d,1);break}return g.n(O,AK(l,X,"musicDownloadsLibraryEntity"),0)})},mFM=function(l){var c=l.videos;
l=[];var Y=[];if(c){c=g.b(c);for(var X=c.next();!X.done;X=c.next()){var k=X.value.offlineVideoData.videoId;X=g.I5(k,"musicTrack");k=g.I5(k,"musicTrackDownloadMetadataEntity");l.push(X);Y.push(k)}}return{W3:l,lc:Y}},hI=function(l,c,Y){c={track:ZOi(c)};
Y&&(c.playlistId=Y);if(l=g.m(l.actionMetadata,W0i))c.maximumDownloadQuality=l.maximumDownloadQuality;return{musicTrackEntityActionMetadata:c}},s66=function(l){var c,Y,X,k,r,e,d,y;
return g.H(function(O){switch(O.D){case 1:return c=g.JC(),Y=skN(l),X=g.c4(Mnc),g.Rn(O,2),r={SR:!0},g.n(O,g.gB(c,Y,X,void 0,r),4);case 4:k=O.G;g.Si(O,3);break;case 2:e=g.vS(O);if(e instanceof g.kT)throw d="GetOffline network manager error: "+e.message,kb(d,e),Error(d);kb("GetOffline fetch request error",e);throw Error("GetOffline fetch request error");case 3:y=Ht(k);if(!k)throw kb("Network request failed"),Error("Network request failed");if(y!==void 0)wd(y);else if(!k.videos||!k.videos.length)throw kb("No data"),
Error("No data");return O.return(k.videos.map(function(D){return D.offlineVideoData}))}})},Bn6=function(l){var c,Y,X,k,r,e,d,y;
return g.H(function(O){switch(O.D){case 1:return c=g.JC(),Y=BgM(l),X=g.c4(Mnc),g.Rn(O,2),r={SR:!0},g.n(O,g.gB(c,Y,X,void 0,r),4);case 4:k=O.G;g.Si(O,3);break;case 2:e=g.vS(O);if(e instanceof g.kT)throw d="GetOffline network manager error for playlist: "+e.message,kb(d,e),Error(d);kb("GetOffline fetch request error for playlist",e);throw Error("GetOffline fetch request error for playlist");case 3:y=Ht(k);if(!k)throw kb("Network request failed for playlist"),Error("Network request failed for playlist");
if(y!==void 0)wd(y,"playlist");else if(!k.playlists||!k.playlists.length)throw kb("No data for playlist"),Error("No data for playlist");return O.return(k.playlists.map(function(D){return D.offlinePlaylistData}))}})},EHc=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV;
return g.H(function(zO){switch(zO.D){case 1:return g.n(zO,lD(),2);case 2:k=zO.G;if(!k)return zO.return([]);r=[];if((e=X)==null?0:e.length){r=X;zO.kT(3);break}return g.n(zO,IK(k,"mainPlaylistEntity"),4);case 4:r=zO.G;case 3:if(!r.length)return zO.return([]);d=[];y=Date.now()/1E3;O=g.b(r);D=O.next();case 5:if(D.done)return d.length?g.n(zO,L0E(d),10):zO.return([]);t=D.value;if(!t.downloadState){U=void 0;zO.kT(8);break}return g.n(zO,FV(k,t.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:U=
zO.G;case 8:G=U;f=void 0;p=(a=(f=t)==null?void 0:f.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;S=Number.isNaN(p)?l:p;h=x=void 0;K=((x=G)==null?0:x.lastSyncedTimestampMillis)?Number((h=G)==null?void 0:h.lastSyncedTimestampMillis)/1E3:0;lc=Q=void 0;E=((Q=G)==null?0:Q.addedTimestampMillis)?Number((lc=G)==null?void 0:lc.addedTimestampMillis)/1E3:0;if(Y||!a||K+S<=y){kv=[];Jg=void 0;if((Jg=t.videos)==null?0:Jg.length)for(I=g.b(t.videos),W=I.next();!W.done;W=
I.next())F=W.value,q=JSON.parse(g.FN(F).entityId),q.videoId&&kv.push(q.videoId);M="0";a&&(mK=void 0,M=String(Number((mK=a.offlineLastModifiedTimestampSeconds)!=null?mK:0).toFixed()));SL={playlistId:t.playlistId,videoIds:kv,offlineLastModifiedTimestamp:M,autoSync:c,offlineDateAddedTimestamp:String(E.toFixed())};d.push(SL)}D=O.next();zO.kT(5);break;case 10:return PV=zO.G,zO.return(PV)}})},gHF=function(){var l,c,Y,X,k;
return g.H(function(r){if(r.D==1)return g.n(r,lD(),2);if(r.D!=3)return(l=r.G)?g.n(r,IK(l,"refresh"),3):r.return(!1);c=r.G;if((Y=c[0])==null||!Y.refreshTime)return r.return(!1);X=Number(c[0].refreshTime);k=Date.now()/1E3;return r.return(isFinite(X)&&k>=X)})},ATV=function(l,c){var Y,X,k;
return g.H(function(r){switch(r.D){case 1:return g.Rn(r,2),g.n(r,u5F(l,c),4);case 4:return X=r.G,g.n(r,nHQ(X),5);case 5:Y=HOM(X);g.Si(r,3);break;case 2:k=g.vS(r),kb("getAndProcessSmartDownloadsResponse request or processing error",k);case 3:return r.return(Y)}})},F0Q=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV;
return g.H(function(zO){switch(zO.D){case 1:return g.n(zO,lD(),2);case 2:k=zO.G;if(!k)return zO.return([]);r=[];if((e=X)==null?0:e.length){r=X;zO.kT(3);break}return g.n(zO,IK(k,"musicPlaylist"),4);case 4:r=zO.G;case 3:if(!r.length)return zO.return([]);d=[];y=Date.now()/1E3;O=g.b(r);D=O.next();case 5:if(D.done)return d.length?g.n(zO,L0E(d),10):zO.return([]);t=D.value;U=void 0;f=(G=(U=t)==null?void 0:U.entityMetadata)&&G.nextAutoRefreshIntervalSeconds?Number(G.nextAutoRefreshIntervalSeconds):NaN;a=
Number.isNaN(f)?l:f;S=p=0;x="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!t.downloadMetadata){zO.kT(8);break}return g.n(zO,FV(k,t.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:h=zO.G,Q=K=void 0,p=Number((Q=(K=h)==null?void 0:K.addedTimestampMillis)!=null?Q:"0")/1E3,E=lc=void 0,S=Number((E=(lc=h)==null?void 0:lc.lastModifiedTimestampMillis)!=null?E:"0")/1E3,Jg=kv=void 0,x=(Jg=(kv=h)==null?void 0:kv.syncState)!=null?Jg:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:I=void 0;if(Y||x!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!G||Number((I=G.lastSyncedTimestampSeconds)!=null?I:0)+a<=y){W=[];F=void 0;if((F=t.tracks)==null?0:F.length)for(q=g.b(t.tracks),M=q.next();!M.done;M=q.next())mK=M.value,W.push(g.FN(mK).entityId);SL={playlistId:t.playlistId,videoIds:W,offlineLastModifiedTimestamp:String(S.toFixed()),autoSync:c,offlineDateAddedTimestamp:String(p.toFixed())};d.push(SL)}D=O.next();zO.kT(5);break;case 10:return PV=zO.G,zO.return(PV)}})},u5F=function(l,c){var Y,X,k,r,e,d,y,O,D,t;
return g.H(function(U){switch(U.D){case 1:return Y=g.JC(),g.n(U,lD(),2);case 2:X=U.G;if(!X){U.kT(3);break}return g.n(U,IDc(X),4);case 4:k=U.G;case 3:var G=k;r={context:g.Fz(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:l},offlineClientState:G,clientStateRequestData:{preferredFormatType:c}}}};e=g.c4(IZe);g.Rn(U,5);y={SR:!0};return g.n(U,g.gB(Y,r,e,void 0,y),7);case 7:d=U.G;g.Si(U,6);break;case 5:O=g.vS(U);if(O instanceof g.kT)throw D=
"DPS network manager error for smart downloads: "+O.message,kb(D,O),Error(D);kb("DPS fetch request error for smart downloads",O);throw Error("DPS fetch request error for smart downloads");case 6:t=Ht(d);if(d)t!==void 0&&wd(t,"smart downloads");else throw kb("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return U.return(d)}})},cLN=function(l,c){var Y,X,k,r,e,d,y,O;
return g.H(function(D){switch(D.D){case 1:return Y=g.JC(),X={context:g.Fz(),videoPlaybackPositionEntities:l,lastSyncTimestampUsec:c},k=g.c4(lJ6),g.Rn(D,2),e={SR:!0},g.n(D,g.gB(Y,X,k,void 0,e),4);case 4:r=D.G;g.Si(D,3);break;case 2:d=g.vS(D);if(d instanceof g.kT)throw y="VPPS network manager error: "+d.message,kb(y,d),Error(y);kb("VPPS fetch request error",d);throw Error("VPPS fetch request error");case 3:O=Ht(r);if(r)O!==void 0&&wd(O,"position sync");else throw kb("Network request failed for position sync"),
Error("Network request failed for position sync");return D.return(r)}})},XFF=function(l,c,Y){var X,k,r,e,d,y,O,D;
return g.H(function(t){switch(t.D){case 1:X=g.JC();var U=Y.refreshData,G=Y.isEnqueuedForExpiredStreamUrlRefetch,f=Y.a7,a=Y.offlineSourceData,p=Y.mediaCapabilities,S={entityKey:l};U&&(S.refreshData=U);G&&(S.isExpiredStreamUrlRefetch=G);f&&(S.downloadParameters=f);a&&(S.offlineSourceData=a);U={context:g.J7(c),signatureTimestamp:20171,videos:[S]};p&&(U.mediaCapabilities=p);k=U;r=g.c4(YeE);g.Rn(t,2);d={SR:!0};return g.n(t,g.gB(X,k,r,void 0,d),4);case 4:e=t.G;g.Si(t,3);break;case 2:y=g.vS(t);if(y instanceof
g.kT)throw O="GetPDE network manager error: "+y.message,kb(O,y),Error(O);kb("GetPDE fetch request error",y);throw Error("GetPDE fetch request error");case 3:D=Ht(e);if(e)D!==void 0&&wd(D,"PDE");else throw kb("Network request failed for PDE"),Error("Network request failed for PDE");return t.return(e)}})},Ht=function(l){var c;
return(c=l.errorMetadata)==null?void 0:c.status},wd=function(l,c){c=c?" for "+c:"";
if(l===0)throw l="Empty response body"+c,kb(l),Error(l);l="Response with error"+c;kb(l);throw Error(l);},L0E=function(l){var c,Y,X,k,r,e,d,y;
return g.H(function(O){switch(O.D){case 1:return c=g.JC(),Y=LzN(l),X=g.c4(kbF),g.Rn(O,2),r={SR:!0},g.n(O,g.gB(c,Y,X,void 0,r),4);case 4:k=O.G;g.Si(O,3);break;case 2:e=g.vS(O);if(e instanceof g.kT)throw d="offlinePlaylistSyncCheck network manager error: "+e.message,kb(d,e),Error(d);kb("offlinePlaylistSyncCheck fetch request error",e);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:y=Ht(k);if(!k)throw kb("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(y!==void 0)wd(y,"playlist sync");else if(!k.offlinePlaylistSyncCheckDatas||!k.offlinePlaylistSyncCheckDatas.length)throw kb("No data for playlist sync"),Error("No data for playlist sync");return O.return(k.offlinePlaylistSyncCheckDatas.map(function(D){return D.offlinePlaylistSyncCheckData}))}})},Kd=function(l){this.D=l},rLN=function(l,c){var Y,X,k,r,e,d;
return g.H(function(y){switch(y.D){case 1:Y=new Map,X=g.b(c),k=X.next();case 2:if(k.done){y.kT(4);break}r=k.value;e=Y;d=e.set;return g.n(y,l.G(r),5);case 5:d.call(e,r,y.G);k=X.next();y.kT(2);break;case 4:return y.return(Y)}})},Tr=function(l,c,Y,X,k,r){c=g.I5(c,Y);
X=Object.assign({},r,{priority:X,retryScheduleIntervalsInSeconds:k});return{actionType:l,entityKey:c,actionMetadata:X}},jw=function(l,c,Y,X,k,r){this.status=l;
this.D=c;this.T=Y;this.G=X;this.K=k;this.downloadState=r},efE=function(l,c,Y){this.D=l;
this.fh=c;this.K=Y},yLi=function(l,c){var Y,X,k,r,e,d,y,O,D;
return g.H(function(t){switch(t.D){case 1:return Y=c.entityKey,k=(X=g.m(c.actionMetadata,VL))==null?void 0:X.isEnqueuedForExpiredStreamUrlRefetch,g.Rn(t,2),r=void 0,g.n(t,JLN(l,c),4);case 4:r=t.G;g.Rn(t,5);var U=(U=g.m(c.actionMetadata,VL))?{maximumDownloadQuality:U.maximumDownloadQuality}:void 0;return g.n(t,XFF(Y,l.fh,{isEnqueuedForExpiredStreamUrlRefetch:k,a7:U,offlineSourceData:r}),7);case 7:e=t.G;g.Si(t,6,2);break;case 5:return g.vS(t,2),d=OF(c)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",kb("PDE handleAdd error"),t.return(or(c,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",d,"DOWNLOAD_STATE_FAILED"));case 6:return g.n(t,dQV(l,e,c),8);case 8:return t.return(or(c,!0,e.orchestrationActions));case 2:return y=g.vS(t),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.bk&&y.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),kb("PDE handleAdd error"),t.return(or(c,!1,void 0,O,D,"DOWNLOAD_STATE_FAILED"))}})},tpe=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg;
return g.H(function(I){switch(I.D){case 1:return Y=c.entityKey,X=g.FN(Y).entityId,g.n(I,uK(l.D,{mode:"readonly",b9:!0},function(W){var F=W$(W,Y,"playbackData"),q=W$(W,g.I5(X,"offlineVideoPolicy"),"offlineVideoPolicy");W=W$(W,g.I5(X,"transfer"),"transfer");return g.SI.all([F,q,W])}),2);
case 2:k=I.G;r=g.b(k);e=r.next().value;d=r.next().value;y=r.next().value;O=e;D=d;t=y;if(!O||!D)return I.return(or(c,!0));U=[];a=((f=O)==null?0:f.playerResponseJson)?JSON.parse(O.playerResponseJson):null;if(!(t&&a&&l.fh.B("html5_refresh_deprecated_downloads"))){I.kT(3);break}G=OWF(l,a,t);return g.n(I,DQQ(l,t),4);case 4:U=I.G;case 3:p={lastPlayerResponseTimestampSeconds:O.playerResponseTimestamp,offlineToken:D.offlineToken,formatIds:U};S={};if((x=t)==null?0:x.maximumDownloadQuality)S.maximumDownloadQuality=
t.maximumDownloadQuality;g.Rn(I,5);h=void 0;return g.n(I,JLN(l,c),7);case 7:return h=I.G,g.Rn(I,8),g.n(I,XFF(Y,l.fh,{refreshData:p,a7:S,offlineSourceData:h,mediaCapabilities:G}),10);case 10:K=I.G;g.Si(I,9,5);break;case 8:return g.vS(I,5),Q=OF(c)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",kb("PDE handleRefresh error"),I.return(or(c,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Q,"DOWNLOAD_STATE_FAILED"));
case 9:return g.n(I,dQV(l,K,c),11);case 11:return I.return(or(c,!0,K.orchestrationActions));case 5:return lc=g.vS(I),E="PDE handleRefresh error",lc instanceof Error&&(E="PDE handleRefresh error: "+lc.message),kv="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Jg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",lc instanceof g.bk&&lc.type==="QUOTA_EXCEEDED"&&(kv="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Jg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),kb(E),I.return(or(c,
!1,void 0,kv,Jg,"DOWNLOAD_STATE_FAILED"))}})},JLN=function(l,c){var Y,X,k,r;
return g.H(function(e){if(e.D==1)return Y=g.FN(c.entityKey).entityId,X=g.I5(Y,"videoDownloadContextEntity"),g.n(e,FV(l.D,X,"videoDownloadContextEntity"),2);k=e.G;return(r=k)!=null&&r.offlineModeType?e.return({offlineModeType:k.offlineModeType}):e.return(void 0)})},dQV=function(l,c,Y){var X,k,r,e,d;
return g.H(function(y){if(y.D==1){if(!c.frameworkUpdates||!g.m(c.frameworkUpdates,Sw))return y.return();if(!(g.m(c.frameworkUpdates,Sw).mutations&&g.m(c.frameworkUpdates,Sw).mutations.length>0&&g.m(c.frameworkUpdates,Sw).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return y.kT(2);X=g.FN(g.m(c.frameworkUpdates,Sw).mutations[0].entityKey).entityId;return g.n(y,vt(l.D,X),3)}if(y.D!=2){k=y.G;r=g.m(Y.actionMetadata,VL);if(d=(e=r)==null?void 0:e.playlistId)k.playlistId=d;k.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.A2(l.fh)?g.n(y,iD(X,l.D,Y,l.K,k),2):g.Zq(l.fh)?g.n(y,xb(X,l.D,Y,l.K),2):y.kT(2)}return g.n(y,oKN(g.m(c.frameworkUpdates,Sw)),0)})},or=function(l,c,Y,X,k,r){return new jw(c?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",OF(l),Y,X,k,r)},OWF=function(l,c,Y){c=aZQ(l.fh,Y.cotn,c);
Y=g.yd(c);return g.TxL(c,Y,l.fh)},DQQ=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U;
return g.H(function(G){if(G.D==1)return Y=[],g.n(G,uK(l.D,{mode:"readonly",b9:!0},function(f){var a=[],p=c.offlineVideoStreams;if(p){p=g.b(p);for(var S=p.next();!S.done;S=p.next())a.push(W$(f,S.value,"offlineVideoStreams"))}return g.SI.all(a)}),2);
if(X=G.G)for(k=g.b(X),r=k.next();!r.done;r=k.next())if(e=r.value,d=void 0,(d=e)==null?0:d.streamsProgress)for(y=e.streamsProgress,O=0;O<y.length;O++)D=y[O],t=JSON.parse(D.formatStreamBytes),U={itag:t.itag,lmt:t.lastModified,xtags:t.xtags},Y.push(U);return G.return(Y)})},UQN=function(l,c){this.D=l;
this.fh=c},GbE=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G;
return g.H(function(f){switch(f.D){case 1:return Y=OF(c),g.n(f,IK(l.D,"videoPlaybackPositionEntity"),2);case 2:X=f.G;if(X.length===0)return f.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.Rn(f,3);return g.n(f,$d.getInstance(),5);case 5:k=f.G;if(!k)throw Error("prefStorage is undefined");return g.n(f,k.get("psi"),6);case 6:return r=f.G,y=(d=(e=r)==null?void 0:e.iW)!=null?d:"0",g.n(f,cLN(X,y),7);case 7:return O=f.G,D={isPaused:O.watchHistoryPaused,iW:O.syncTimestampUsec},g.n(f,k.set("psi",
D),8);case 8:if(D.isPaused){f.kT(9);break}t=g.m(O.frameworkUpdates,Sw);if(!O.frameworkUpdates||!t){f.kT(9);break}return g.n(f,oKN(t),9);case 9:g.Si(f,4);break;case 3:return U=g.vS(f),G="PPE handleRefresh error: "+(U instanceof Error?U.message:"unknown error"),kb(G),f.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return f.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},Pf6=function(l,c){var Y,X,k,r,e,d,y,O;
return g.H(function(D){switch(D.D){case 1:return Y=OF(c),X=g.FN(c.entityKey).entityId,g.Rn(D,2),g.n(D,$d.getInstance(),4);case 4:k=D.G;if(!k)throw Error("prefStorage is undefined");return g.n(D,k.get("psi"),5);case 5:r=D.G;e=g.m(c.actionMetadata,fJL);if(((d=r)==null?void 0:d.isPaused)!==!1||(y=e)==null||!y.lastPlaybackPositionSeconds){D.kT(6);break}O={key:g.I5(X,"videoPlaybackPositionEntity"),videoId:X,lastPlaybackPositionSeconds:e.lastPlaybackPositionSeconds};return g.n(D,AK(l.D,O,"videoPlaybackPositionEntity"),
6);case 6:g.Si(D,3);break;case 2:return g.vS(D),D.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},bWV=function(l,c){var Y,X,k;
return g.H(function(r){switch(r.D){case 1:Y=OF(c);g.Rn(r,2);X=g.FN(c.entityKey).entityId;if(X==="!*$_ALL_ENTITIES_!*$")return g.n(r,wqQ(l.D),5);k=g.I5(X,"videoPlaybackPositionEntity");return g.n(r,HfQ(l.D,k),5);case 5:g.Si(r,3);break;case 2:return g.vS(r),r.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},qeN=function(l,c){this.api=l;
this.D=c;this.logger=new g.eh("woffle");this.G=!1;this.gk={Nb:this.Nb};this.logger.debug("Initialized OfflineMediaManager")},aJN=function(l){return g.H(function(c){return c.return(Mti(l))})},NY6=function(l){var c;
return g.H(function(Y){if(Y.D==1)return g.n(Y,g.k1g(l),2);c=Y.G;return Y.return(c.filter(function(X){return!!X.url}).map(function(X){return X.url}))})},Cd=function(l,c){var Y=g.HZ(c);
if(Y===1||Y===0)return Promise.resolve();(Y=pFE(l,c))&&Y.stopVideo();l.K=0;return aJN(c)},Zs=function(l,c,Y,X){Y=Y===void 0?!1:Y;
X=X===void 0?!0:X;var k=typeof c==="string"?c:c.videoDetails.videoId;g.HZ(k)===2&&((c=pFE(l,k))?c.stopVideo():l.logger.info(function(){return"Corresponding player for "+k+" not found. Pausing anyway"}),g.wa(k,2),l.K=2,Y?RfU(l.D):X&&iWa(l.D))},pFE=function(l,c){var Y;
return((Y=l.player)==null?void 0:Y.getVideoData().videoId)===c?l.player:null},Sei=function(l,c,Y){c.getPlayerResponse();
g.wa(c.videoId,2);l.K=2;l.G=!1;var X;(X=l.player)==null||X.dispose();l.player=l.api.fN(c);c={};l.player.lH((c.localmediachange=l.JP,c.signatureexpired=l.pL,c.statechange=l.ZCd,c),l);var k=l.Nb(Y);l.player.l$(g.e4(k,k,!0,"m"),!1);l.logger.debug(function(){return"Starting headless playback with quality: "+k});
l.player.xw(!1)},vUi=function(l,c){this.D=l;
this.fh=c},zfE=function(l,c){var Y,X;
return g.H(function(k){switch(k.D){case 1:return Y=OF(c),g.n(k,FV(l.D,c.entityKey,"transfer"),2);case 2:if(X=k.G)return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.Rn(k,3);return g.n(k,xQN(l,c),5);case 5:g.Si(k,4);break;case 3:return g.vS(k),k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},nUN=function(l,c){var Y,X;
return g.H(function(k){switch(k.D){case 1:return Y=OF(c),g.n(k,FV(l.D,c.entityKey,"transfer"),2);case 2:X=k.G;if(!X||X.transferState!=="TRANSFER_STATE_COMPLETE")return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.Rn(k,3);return g.n(k,xQN(l,c,!0),5);case 5:g.Si(k,4);break;case 3:return g.vS(k),k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},hfU=function(l,c){var Y,X,k,r,e,d,y,O,D,t;
return g.H(function(U){switch(U.D){case 1:return Y=OF(c),X=g.FN(c.entityKey).entityId,g.n(U,uK(l.D,{mode:"readonly",b9:!0},function(G){var f=W$(G,c.entityKey,"transfer");G=W$(G,g.I5(X,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.SI.all([f,G])}),2);
case 2:k=U.G;r=g.b(k);e=r.next().value;d=r.next().value;y=e;O=d;if(!y||y.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return U.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.Rn(U,3);y.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.n(U,AK(l.D,y,"transfer"),5);case 5:D=g.FN(y.key).entityId;yL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:D,kS:y,offlineModeType:(t=O)==null?void 0:t.offlineModeType});g.Si(U,
4);break;case 3:return g.vS(U),U.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return U.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},xQN=function(l,c,Y){Y=Y===void 0?!1:Y;
var X,k,r,e,d,y,O,D,t,U,G,f,a,p,S;return g.H(function(x){switch(x.D){case 1:return X=g.m(c.actionMetadata,HWF),k=g.FN(c.entityKey).entityId,r=g.I5(k,"downloadStatusEntity"),g.n(x,uK(l.D,{mode:"readonly",b9:!0},function(h){var K=W$(h,r,"downloadStatusEntity");h=W$(h,g.I5(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.SI.all([K,h])}),2);
case 2:return e=x.G,d=g.b(e),y=d.next().value,O=d.next().value,D=y,t=O,U="TRANSFER_STATE_TRANSFER_IN_QUEUE",((G=D)==null?void 0:G.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(U="TRANSFER_STATE_PAUSED_BY_USER"),p={key:c.entityKey,transferState:U,cotn:g.vw(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(f=X)==null?void 0:f.maximumDownloadQuality,preferredAudioTrack:(a=X)==null?void 0:a.preferredAudioTrack,transferRetryCount:0,isRefresh:Y,hasLoggedFirstStarted:!1},g.n(x,uK(l.D,
{mode:"readwrite",b9:!0},function(h){var K=[];Y&&K.push(LT(h,g.I5(k,"offlineVideoStreams")));K.push(B$(h,p,"transfer"));return g.SI.all(K)}),3);
case 3:if(!Y){x.kT(4);break}return g.n(x,aJN(k),4);case 4:yL({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:k,kS:p,offlineModeType:(S=t)==null?void 0:S.offlineModeType}),g.pL(x)}})},KSi=function(l,c,Y,X){if(!l.action.entityKey)throw Error("entityKey is missing.");
var k=g.FN(l.action.entityKey);k={entityType:k.jn,entityId:k.entityId,offlineOrchestrationActionType:l.action.actionType,orchestrationAction:{orchestrationActionId:l.actionId}};c&&(k.offlineOrchestrationActionResult=c.status,k.isRetryable=Y?!1:c.D,c.K&&(k.offlineOrchestrationFailureReason=wFV(c.K,k.isRetryable)));var r,e;if((r=l.action.actionMetadata)==null?0:(e=r.offlineLoggingData)==null?0:e.offlineModeType)k.offlineModeType=l.action.actionMetadata.offlineLoggingData.offlineModeType;X&&(k.additionalOrchestrationActions=
X.map(function(d){return{orchestrationActionId:d.actionId}}));
return k},wFV=function(l,c){return l!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||c?l==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&c?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":l:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},TYE=function(l,c){var Y={offlineOrchestrationContext:KSi(l)};
c=Aza(c,Y);FzM(u4e(),c,l.rootActionId)},jjQ=function(l,c,Y,X){X=X===void 0?[]:X;
c={offlineOrchestrationContext:KSi(l,c,Y,X)};c=Aza(3,c);FzM(u4e(),c,l.rootActionId)},VpU=function(){this.actions=[]},oU7=function(l,c){c=g.b(c);
for(var Y=c.next();!Y.done;Y=c.next())Y=Y.value,TYE(Y,1),l.actions.push(Y);l.actions.sort(l.D)},Cfi=function(l,c){if(c)for(var Y=0;Y<l.actions.length;Y++)if(c==="!*$_ALL_ENTITIES_!*$"&&l.actions[Y].actionId!==c||c!=="!*$_ALL_ENTITIES_!*$"&&l.actions[Y].rootActionId===c&&l.actions[Y].actionId!==c)l.actions.splice(Y,1),Y--},ZWa=function(l,c){l=g.b(l.actions);
for(var Y=l.next();!Y.done;Y=l.next())if(Y.value.actionId===c)return!0;return!1},$b=function(l,c,Y,X,k){g.C.call(this);
var r=this;this.G=l;this.xT=c;this.AJ=Y;this.C=X;this.fh=k;this.D=new VpU;this.W=new g.u1;this.K=new g.gY(function(){r.retry()});
this.U=NaN;this.N=!1;this.gk={Zo7:function(){return r.D},
p6:function(){return r.W},
UUz:function(){return r.K},
retry:function(){return r.retry()}};
g.Z(this,this.K);this.j=this.G.observe(this.Kh.bind(this))},mQa=function(l,c,Y,X,k){var r;
return g.H(function(e){if(e.D==1)return r=new $b(l,c,Y,X,k),g.n(e,$QQ(r),2);QjV(r);return e.return(r)})},QjV=function(l){var c=l.D.actions[0];
return l.T?((c==null?void 0:c.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.T[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(l.N=!0),Promise.resolve()):WSU(l)},WSU=function(l){var c,Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S;
return g.H(function(x){switch(x.D){case 1:if(l.T)throw Error("Already processing an action");if(l.vU())return x.return();c=l.D.actions.shift();DFQ(l.AJ,!c);if(c===void 0)return x.return();c.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&c.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Cfi(l.D,c.actionId);Y="";c.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&c.rootActionId===c.actionId&&(Y=c.actionId);X=[c];l.T=X;if(k=l.xT[c.entityType]){x.kT(2);break}l.T=
void 0;return g.n(x,WSU(l),3);case 3:return x.return();case 2:r=g.b(X);for(e=r.next();!e.done;e=r.next())d=e.value,TYE(d,2);g.Rn(x,4,5);return g.n(x,rLN(k,X.map(function(h){return h.action})),7);
case 7:y=x.G,O=g.b(X),D=O.next();case 8:if(D.done){x.kT(10);break}t=D.value;U=y.get(t.action);return g.n(x,MpU(l,t,U),9);case 9:D=O.next();x.kT(8);break;case 10:Cfi(l.D,Y);case 5:g.xv(x);l.T=void 0;g.nL(x,6);break;case 4:return G=g.vS(x),kb("Orchestration error",G),g.Rn(x,12),g.n(x,sja(l,X),14);case 14:g.Si(x,5);break;case 12:f=g.vS(x);kb("Orchestration retry error",f);a=g.b(X);for(p=a.next();!p.done;p=a.next())S=p.value,S.retryScheduleIndex<3&&oU7(l.D,[S]);x.kT(5);break;case 6:return g.n(x,WSU(l),
0)}})},MpU=function(l,c,Y){var X,k,r,e,d,y,O,D,t,U,G,f;
return g.H(function(a){switch(a.D){case 1:X=c.retryScheduleIndex+2===3;if(Y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){a.kT(2);break}if(Y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){a.kT(0);break}jjQ(c,Y,X);if(Y.D&&c.retryScheduleIndex+1<3)return g.n(a,sja(l,[c]),0);r=((k=Y)==null?0:k.G)?Y.G:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";e={entityKey:c.action.entityKey,failureReason:r};d=void 0;g.A2(l.fh)?d="mainVideoDownloadStateEntity":g.Zq(l.fh)&&(d="musicTrackDownloadMetadataEntity");
if(!d||!Y.downloadState){a.kT(7);break}y=g.FN(c.action.entityKey).entityId;return g.n(a,Gr(y,d,l.G,Y.downloadState),7);case 7:ew(l.C,e);if(Y.downloadState==="DOWNLOAD_STATE_FAILED"&&l.fh.B("html5_auto_retry_failed_pde_actions")){a.kT(0);break}kb("Orchestration result is not retryable, deleting action");return g.n(a,HfQ(l.G,NY(c).key),0);case 2:O=void 0;try{O=(D=Y.T)==null?void 0:D.map(function(p){return l.createAction(p,c)})}catch(p){return jjQ(c,Y,X),t={entityKey:c.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},ew(l.C,t),kb("Orchestration subactions creation error",p),a.return()}jjQ(c,Y,X,O);if(!O){a.kT(12);break}U=O.map(function(p){return NY(p)});
G=0;case 13:if(!(G<O.length)||l.N){a.kT(15);break}return g.n(a,uK(l.G,{mode:"readwrite",b9:!0},function(p){var S=[];S.push(NgN(p,U.slice(G,G+10),"offlineOrchestrationActionWrapperEntity"));return g.SI.all(S)}),16);
case 16:G+=10;a.kT(13);break;case 15:if(l.N)return l.N=!1,a.return();case 12:return f=NY(c),g.n(a,HfQ(l.G,f.key),17);case 17:TYE(c,4),g.pL(a)}})},gUM=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G;
return g.H(function(f){Y=[];X=Infinity;k=4E3;r=g.b(c);for(e=r.next();!e.done;e=r.next())d=e.value,y=Number(d.enqueueTimeSec),O=BYN(y),D=d.retryScheduleIndex,t=D!=null&&D>0,O>0&&t?(X=Math.min(X,y),k=Math.min(O,k)):Y.push(d);isFinite(X)&&(!l.K.isActive()||X<l.U)&&(l.U=X,l.K.start(k));l.W.Hp()||(U=Y.length,Y=Y.filter(function(a){var p;a=((p=a.actionProto)==null?void 0:p.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!LSi.includes(a)}),G=Y.length<U,!l.K.isActive()&&G&&l.K.start(1));
Y.length>0&&EUa(l,Y);return g.n(f,QjV(l),0)})},ALU=function(l){var c,Y,X,k,r,e,d;
return g.H(function(y){if(y.D==1)return g.n(y,uYQ(l),2);c=y.G;Y=[];X=g.b(c);for(k=X.next();!k.done;k=X.next())r=k.value,e=g.FN(r.key),d=e.entityId,ZWa(l.D,d)||Y.push(r);return g.n(y,gUM(l,Y),0)})},BYN=function(l){l=l*1E3-Date.now();
return l>4E3?4E3:l},sja=function(l,c){var Y,X,k;
return g.H(function(r){Y=g.b(c);for(X=Y.next();!X.done;X=Y.next()){k=X.value;var e=void 0,d=void 0,y=((d=k.action)==null?void 0:(e=d.actionMetadata)==null?void 0:e.retryScheduleIntervalsInSeconds)||[1,2,4];e=1;k.retryScheduleIndex<y.length&&(e=y[k.retryScheduleIndex]);k.D=e*1E3+Date.now();k.retryScheduleIndex++}return g.n(r,FS6(l,c),0)})},$QQ=function(l){var c;
return g.H(function(Y){if(Y.D==1)return g.n(Y,IK(l.G,"offlineOrchestrationActionWrapperEntity"),2);c=Y.G;return g.n(Y,gUM(l,c),0)})},EUa=function(l,c){c.length!==0&&c.forEach(function(Y){Y=ar(Y);
Y.retryScheduleIndex<3&&oU7(l.D,[Y])})},uYQ=function(l,c){var Y;
return g.H(function(X){if(X.D==1)return g.n(X,IK(l.G,"offlineOrchestrationActionWrapperEntity",c),2);Y=X.G;return X.return(Y.filter(CeL))})},FS6=function(l,c){if(c.length===0)return Promise.resolve([]);
c=c.map(function(Y){return NY(Y)});
return h6Q(l.G,c)},IJL=function(l){this.Ih=l;
this.D=void 0},lKM=function(l,c){var Y,X,k,r;
return g.H(function(e){Y=c.videoId;X=!0;if(c.captionTracks.length)k=PjL(c),l.D=new g.bg(l.Ih,c,k);else if(c.EG)r=g.GKL(c),l.D=new g.aS(l.Ih,c.EG,Y,r,c.y6,c.eventId),X=c.y6;else return e.return();return e.return(new Promise(function(d){var y;(y=l.D)==null||y.LO({YA:function(){return g.H(function(O){if(O.D==1)return g.n(O,l.YA(Y,X),2);d();g.pL(O)})},
rX:function(){}})}))})},cjQ=function(l){var c;
return g.H(function(Y){if(Y.D==1)return g.n(Y,Wze(l),2);c=Y.G;return Y.return(!!c&&c.length>0)})},QL=function(l){g.C.call(this);
this.D=l;this.G=this.D.observe(this.K.bind(this))},YDV=function(l,c){var Y,X,k,r,e,d,y;
return g.H(function(O){switch(O.D){case 1:if(c.length===0)return O.return([]);Y=c.map(function(D){return g.I5(D,"transfer")});
return g.n(O,IK(l.D,"transfer",Y),2);case 2:X=O.G;k=X.filter(CeL).map(function(D){return g.FN(D.key).entityId});
r=c.filter(function(D){return k.indexOf(D)===-1});
if(r.length===0)return O.return([]);e=g.b(r);d=e.next();case 3:if(d.done){O.kT(5);break}y=d.value;return g.n(O,aJN(y),4);case 4:d=e.next();O.kT(3);break;case 5:return O.return(r)}})},rj7=function(l,c,Y,X,k,r){var e,d,y;
return g.H(function(O){e="STREAM_TYPE_UNKNOWN";Y.video&&Y.audio?(e="STREAM_TYPE_AUDIO_AND_VIDEO",kb("unexpected stream type")):Y.video&&!Y.audio?e="STREAM_TYPE_VIDEO":!Y.video&&Y.audio&&(e="STREAM_TYPE_AUDIO");d=g.I5(c,"offlineVideoStreams");y={numBytesDownloaded:k.toFixed(),numTotalBytes:r.toFixed(),streamType:e,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(X),itag:e==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Y.itag):void 0};return g.n(O,uK(l,{mode:"readwrite",b9:!0},
function(D){var t=W$(D,d,"offlineVideoStreams"),U=W$(D,g.I5(c,"transfer"),"transfer");return g.SI.all([t,U]).then(function(G){G=g.b(G);var f=G.next().value;G=G.next().value;if(!G)return LT(D,d).then(function(){});
var a=XT6(f);f=kDN(f,X,y,d);var p=B$(D,f,"offlineVideoStreams");XT6(f)>a&&(G.lastProgressTimeMs=Date.now().toString());a=[p];G.offlineVideoStreams||(G.offlineVideoStreams=[]);G.offlineVideoStreams.indexOf(d)===-1&&(G.offlineVideoStreams.push(d),a.push(B$(D,G,"transfer")));return g.SI.all(a)})}),0)})},eOM=function(l,c){var Y,X,k,r,e;
return g.H(function(d){if(d.D==1)return Y=g.I5(c,"offlineVideoStreams"),g.n(d,FV(l,Y,"offlineVideoStreams"),2);X=d.G;if(!X||!X.streamsProgress)return d.return();k=g.b(X.streamsProgress);for(r=k.next();!r.done;r=k.next())e=r.value,e.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",e.numTotalBytes!==e.numBytesDownloaded&&(e.numBytesDownloaded=e.numTotalBytes);return g.n(d,AK(l,X,"offlineVideoStreams"),0)})},kDN=function(l,c,Y,X){if(l&&l.streamsProgress){X=l;
a:{c=c.itag+";"+c.xtags;for(var k=l.streamsProgress,r=0;r<k.length;r++){var e=JSON.parse(k[r].formatStreamBytes);if(e.itag+";"+e.xtags===c){k[r]=Y;Y=k;break a}}k.push(Y);Y=k}X.streamsProgress=Y}else l={key:X,streamsProgress:[Y]};return l},XT6=function(l){if(l==null?0:l.streamsProgress){var c=0;
l=l.streamsProgress;for(var Y=0;Y<l.length;Y++){var X=l[Y];isNaN(Number(X.numBytesDownloaded))?kb("stream progress bytes number invalid"):c+=Number(X.numBytesDownloaded)}return c}return 0},Jj6=function(l,c,Y,X){g.C.call(this);
var k=this;this.G=l;this.api=c;this.ZA=Y;this.Kh=X;this.W=new g.u1;this.T=new g.gY(function(){k.D&&k.D.transferState==="TRANSFER_STATE_TRANSFERRING"&&k.W.Hp()&&((k.D.transferRetryCount||0)<3?Zs(k.C,k.N,!1,!1):Cd(k.C,k.N.videoDetails.videoId),k.wx("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.AJ=this.PU=0;this.j=this.U=!1;this.Ed=g.GR(this.api.L().experiments,"html5_transfer_processing_logs_interval");this.yf=new g.Cr(this);this.gk={cEf:function(){return k.T},
vof:function(){return k.Kh},
p6:function(){return k.W}};
this.xT=this.G.observe(this.BQ.bind(this));this.C=new qeN(c,this);this.nh=new IJL(c);this.JJ=new QL(this.G);this.NQ=this.W.listen("publicytnetworkstatus-online",this.DI.bind(this));this.Ch=this.W.listen("publicytnetworkstatus-offline",this.KNh.bind(this));this.j=this.api.L().B("html5_less_transfer_processing_logs");g.Z(this,this.yf);this.yf.Z(c,"offlinetransferpause",this.t00);g.A2(this.api.L())?this.K="mainVideoDownloadStateEntity":g.Zq(this.api.L())&&(this.K="musicTrackDownloadMetadataEntity")},
dwF=function(l){return g.H(function(c){if(c.D==1)c=g.n(c,Qke(),2);
else{var Y=l.JJ;var X=g.ht();X=Object.keys(X);Y=YDV(Y,X);c=g.n(c,Y,0)}return c})},Wt=function(l,c){c=c===void 0?!1:c;
var Y;return g.H(function(X){if(X.D==1){if(l.D)throw Error("Already downloading a video");l.AJ=0;l.U=!1;return g.n(X,yj7(l),2)}return X.D!=4?(Y=X.G,tnM(l.ZA,!Y),Y&&l.W.Hp()?c?g.n(X,new Promise(function(k){g.PU(k,1E3)}),4):X.kT(4):(!Y&&l.D&&mR(l),X.kT(0))):g.n(X,O6Q(l,Y),0)})},DwL=function(l){return g.H(function(c){if(c.D==1)return l.N?g.n(c,Cd(l.C,l.N.videoDetails.videoId),3):c.kT(0);
mR(l);g.pL(c)})},tqF=function(l,c){var Y,X,k;
return g.H(function(r){switch(r.D){case 1:return g.Rn(r,2),(Y=!!c.captionTracks.length||!!c.EG)?g.n(r,cjQ(c.videoId),4):r.return();case 4:return(X=r.G)?r.return():g.n(r,lKM(l.nh,c),5);case 5:g.Si(r,0);break;case 2:k=g.vS(r),kb("Caption downloading error",k,c.cotn),g.pL(r)}})},O6Q=function(l,c){var Y,X,k,r,e,d;
return g.H(function(y){switch(y.D){case 1:if(l.U)return y.return();l.U=!0;l.D=c;Y=g.FN(l.D.key);X=Y.entityId;k=void 0;if(l.D.transferState==="TRANSFER_STATE_TRANSFERRING")return g.n(y,MY(l,X),7);if(l.D.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||l.D.transferRetryCount||l.D.hasLoggedFirstStarted){y.kT(3);break}return g.n(y,MY(l,X),5);case 5:return k=y.G,l.D.hasLoggedFirstStarted=!0,g.n(y,Uwe(l),6);case 6:UFc({videoId:X,kS:l.D,offlineModeType:k},void 0,void 0,!0);y.kT(3);break;case 7:k=y.G,
yL({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:X,kS:l.D,offlineModeType:k});case 3:return g.n(y,GDe(l),8);case 8:return r=null,g.Rn(y,9),g.n(y,fKN(l,c),11);case 11:r=y.G;l.N=r;g.Si(y,10);break;case 9:return e=g.vS(y),kb("error getting player response",e,c.cotn),g.n(y,l.wx("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return y.return();case 10:return d=aZQ(l.api.L(),c.cotn,r),g.n(y,tqF(l,d),13);case 13:return g.n(y,NY6(d.videoId),
14);case 14:d.YB=y.G,Sei(l.C,d,c.maximumDownloadQuality),l.T.start(108E5),g.pL(y)}})},yj7=function(l){var c,Y;
return g.H(function(X){if(X.D==1)return g.n(X,IK(l.G,"transfer"),2);c=X.G;Y=c.filter(P6a).sort(b6V);return Y.length===0?X.return():X.return(Y[0])})},GDe=function(l){var c,Y,X;
return g.H(function(k){if(k.D==1){if(!l.D)return sF(l,"onTransferStart"),k.return();l.T.start(108E5);return g.n(k,Bt(l,"TRANSFER_STATE_TRANSFERRING"),2)}c=l.D;return(X=((Y=c)==null?0:Y.key)?g.FN(c.key).entityId:"")&&l.K?g.n(k,Gr(X,l.K,l.G,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):k.kT(0)})},RfU=function(l){var c,Y,X,k;
g.H(function(r){switch(r.D){case 1:if(!l.D){sF(l,"onTransferPausedByUser");r.kT(2);break}c=l.D;l.T.stop();return g.n(r,Bt(l,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:X=((Y=c)==null?0:Y.key)?g.FN(c.key).entityId:"";if(!X||!l.K){r.kT(4);break}return g.n(r,Gr(X,l.K,l.G,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.n(r,MY(l,X),6);case 6:k=r.G,GsL({videoId:X,kS:c,offlineModeType:k});case 2:mR(l),Wt(l),g.pL(r)}})},iWa=function(l){var c,Y,X;
g.H(function(k){if(k.D==1){if(!l.D)return sF(l,"onTransferPausedByNetwork"),k.return();l.T.stop();return g.n(k,Bt(l,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(k.D!=3)return c=l.D,(X=((Y=c)==null?0:Y.key)?g.FN(c.key).entityId:"")&&l.K?g.n(k,Gr(X,l.K,l.G,"DOWNLOAD_STATE_PAUSED"),3):k.kT(3);mR(l);g.pL(k)})},qDa=function(l){var c,Y,X,k,r;
g.H(function(e){switch(e.D){case 1:if(!l.D)return sF(l,"onTransferComplete"),e.return();c=l.D;l.T.stop();if(!c||!l.N){e.kT(2);break}Y=aZQ(l.api.L(),c.cotn,l.N);return g.n(e,tqF(l,Y),2);case 2:return g.n(e,Bt(l,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:k=((X=c)==null?0:X.key)?g.FN(c.key).entityId:"";if(!k||!l.K){e.kT(5);break}return g.n(e,Gr(k,l.K,l.G,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.n(e,eOM(l.G,k),7);case 7:return g.n(e,MY(l,k),8);case 8:r=e.G,yL({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:k,kS:c,offlineModeType:r}),mR(l),Wt(l),g.pL(e)}})},aKL=function(l,c,Y){var X,k;
g.H(function(r){switch(r.D){case 1:if(!l.D)return sF(l,"onTransferProgress: "+c),r.return();if(l.D.transferState==="TRANSFER_STATE_TRANSFERRING"){r.kT(2);break}return g.n(r,GDe(l),2);case 2:X=Date.now();if(!(X-l.PU>1E3)){r.kT(4);break}l.PU=X;return g.n(r,rj7(l.G,Y.videoId,Y.G,Y.Gq,Y.bytesDownloaded,Y.D),5);case 5:if(l.j&&!(l.j&&X-l.AJ>l.Ed)){r.kT(4);break}l.AJ=X;return g.n(r,MY(l,c),7);case 7:k=r.G,UFc({videoId:c,kS:l.D,offlineModeType:k},Y.bytesDownloaded,Y.D);case 4:l.T.start(108E5),g.pL(r)}})},
NRi=function(l){var c=(l.D.transferRetryCount||0)<3;
c&&(l=l.D,l.transferRetryCount=(l.transferRetryCount||0)+1);return c},pTc=function(l,c){c=c===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":c;
var Y,X,k,r;return g.H(function(e){if(e.D==1)return l.D||sF(l,"setTransferToFailed: "+c),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c==="TRANSFER_FAILURE_REASON_NETWORK"?Y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":c==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.n(e,Bt(l,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",c),2);if(e.D!=3)return ew(l.Kh,{entityKey:(X=l.D)==null?void 0:X.key,failureReason:Y}),
k=l.D?g.FN(l.D.key).entityId:"",g.n(e,MY(l,k),3);r=e.G;var d={videoId:k,kS:l.D,offlineModeType:r},y=c,O={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};y&&(O.transferFailureReason=y,O.failureReason=fZe(y));yL(O,d);g.pL(e)})},Bt=function(l,c,Y,X){var k;
return g.H(function(r){if(r.D==1){if(!l.D)return sF(l,"saveTransferState: "+c),r.return();l.D.transferState=c;l.D.failureReason=X;g.Rn(r,2);return g.n(r,Uwe(l,function(e){return Y?Mv(e,"offlineVideoStreams",l.D.offlineVideoStreams).then(function(d){for(var y=g.b(d),O=y.next();!O.done;O=y.next())if((O=O.value)&&O.streamsProgress){O=g.b(O.streamsProgress);for(var D=O.next();!D.done;D=O.next())D.value.streamState=Y}return NgN(e,d.filter(function(t){return!!t}),"offlineVideoStreams")}):g.SI.resolve(void 0)}),
4)}if(r.D!=2)return g.Si(r,0);
k=g.vS(r);return k instanceof g.bk&&k.type==="QUOTA_EXCEEDED"?g.n(r,l.wx("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):r.kT(0)})},Uwe=function(l,c){var Y;
return g.H(function(X){if(!l.D)return X.return();Y=l.D;return g.n(X,uK(l.G,{mode:"readwrite",b9:!0},function(k){var r=[B$(k,Y,"transfer")];c&&r.push(c(k));return g.SI.all(r)}),0)})},mR=function(l){l.D=void 0;
l.N=void 0;l.T.stop()},fKN=function(l,c){var Y,X,k,r,e;
return g.H(function(d){if(d.D==1)return Y=g.FN(c.key),X=Y.entityId,k=g.I5(X,"playbackData"),g.n(d,FV(l.G,k,"playbackData"),2);r=d.G;if((e=r)==null?0:e.playerResponseJson)return d.return(JSON.parse(r.playerResponseJson));throw Error("No PlayerResponse found");})},sF=function(l,c){l.api.Gz("woffle",{mcte:c});
kb("missing current transfer entity.")},MY=function(l,c){var Y,X,k;
return g.H(function(r){if(r.D==1)return g.n(r,FV(l.G,g.I5(c,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Y=r.G;return r.return((k=(X=Y)==null?void 0:X.offlineModeType)!=null?k:void 0)})},P6a=function(l){return ROi[l.transferState]!==void 0},b6V=function(l,c){var Y=ROi[l.transferState],X=ROi[c.transferState];
return Y!==X?Y-X:Number(l.enqueuedTimestampMs)-Number(c.enqueuedTimestampMs)},Ld=function(l,c){var Y=this;
this.fh=l;this.api=c;this.W=new g.u1;this.N=new g.vb;this.gk={Rq:function(){return Y.K.gk.Rq()},
p6:function(){return Y.W},
Ho0:function(){return Y.K},
dQ:function(){return Y.dQ()},
DD:function(){return Y.DD()},
Q7:function(){return Y.Q7()},
PT:function(){return Y.PT()},
xs:function(){return Y.xs()},
YV:function(X){return Y.YV(X)}};
this.K=new dF7(function(){return i6c(Y)},function(){Y.Q7()},this.api.b2(),this.api.B.bind(this.api));
this.D=new rd(this.api);yT6(this.K)},i6c=function(l){return g.H(function(c){l.api.cU("onOrchestrationBecameLeader");
return g.n(c,l.DD(),0)})},vV6=function(l){var c,Y;
return g.H(function(X){if(X.D==1)return g.n(X,lD(),2);if(X.D!=3){c=X.G;if(!c)return kb("PES is undefined"),X.return();l.G=new Jj6(c,l.api,l.K,l.D);Y=l.LN(c);return g.n(X,mQa(c,Y,l.K,l.D,l.fh),3)}l.C=X.G;return g.n(X,SDa(l),0)})},SDa=function(l){var c;
return g.H(function(Y){switch(Y.D){case 1:if(!l.G)return kb("transferManager is undefined"),Y.return();if(l.G.D){Y.kT(2);break}return g.n(Y,Wt(l.G),2);case 2:if(!l.fh.B("woffle_enable_main_downloads_library")){Y.kT(4);break}return g.n(Y,l.tR(),4);case 4:if(!l.fh.B("html5_offline_playback_position_sync")){Y.kT(6);break}return g.n(Y,l.lT(),7);case 7:return g.n(Y,l.YV(864E5),6);case 6:return g.n(Y,l.refreshAllStaleEntities(43200,!0),9);case 9:return g.n(Y,l.K7(),10);case 10:if(!l.fh.B("html5_retry_downloads_for_expiration")){Y.kT(11);
break}return g.n(Y,l.xs(),11);case 11:return l.U=g.ba(function(){l.refreshAllStaleEntities(43200,!0);l.K7()},9E5),g.IE(g.cH(),function(){return l.PT()}),g.n(Y,lD(),13);
case 13:return c=Y.G,g.n(Y,JTQ(c),14);case 14:OOF(l.K),g.pL(Y)}})},xw6=function(){var l,c,Y,X,k,r;
return g.H(function(e){switch(e.D){case 1:return g.n(e,lD(),2);case 2:l=e.G;if(!l)return e.return([]);c=Date.now()/1E3;return g.n(e,IK(l,"offlineVideoPolicy"),3);case 3:Y=e.G,X=g.b(Y),k=X.next();case 4:if(k.done){e.kT(6);break}r=k.value;if(!(r.expirationTimestamp&&Number(r.expirationTimestamp)<c)){e.kT(5);break}r.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";r.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.n(e,AK(l,r,"offlineVideoPolicy"),5);
case 5:k=X.next();e.kT(4);break;case 6:return e.return(Y.map(function(d){return d.key}))}})},EF=function(l,c,Y,X,k){var r,e,d;
return g.H(function(y){if(y.D==1)return g.n(y,lD(),2);r=y.G;if(!r)return y.return([]);e=c.map(function(O){var D=g.I5(O,Y);D={actionType:X,entityKey:D,actionMetadata:Object.assign({},NnE(),k)};X!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(D.actionMetadata.priority=0);O=new qY(Y,O,D);return NY(O)});
d=h6Q(r,e);yT6(l.K);return y.return(d)})},zON=function(l,c,Y,X){var k,r,e,d,y,O,D,t;
return g.H(function(U){switch(U.D){case 1:k=[],r=g.b(c),e=r.next();case 2:if(e.done){U.kT(4);break}d=e.value;if(d.upToDate||Y&&!d.shouldAutoSyncMetadata||!d.playlistId){U.kT(3);break}y={};switch(X){case "mainPlaylistEntity":O={nextAutoRefreshIntervalSeconds:d.checkInSeconds,autoSync:Y};y={mainPlaylistEntityActionMetadata:O};break;case "musicPlaylist":D={autoSync:Y},y={musicPlaylistEntityActionMetadata:D}}return g.n(U,EF(l,[d.playlistId],X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",y),6);case 6:(t=
U.G)&&k.push.apply(k,g.N(t));case 3:e=r.next();U.kT(2);break;case 4:return U.return(k)}})},nVM=function(l,c){var Y;
return g.H(function(X){return c.length?(Y=NnE(),g.WR(Y,VL,{isEnqueuedForExpiredStreamUrlRefetch:!0}),l.api.Gz("qrd",{v:c.length}),X.return(EF(l,c,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y))):X.return([])})},hOF=function(l,c,Y){this.D=l;
this.fh=c;this.K=Y},KCi=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x;
return g.H(function(h){switch(h.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,r=[],g.Rn(h,2),g.n(h,H6F(l,k),4);case 4:r=h.G;if(!(l.fh.B("woffle_enable_main_downloads_library")&&((e=r)==null?0:e.length))){h.kT(5);break}return g.n(h,TnN(l.D,[c.entityKey]),5);case 5:g.Si(h,3);break;case 2:return d=g.vS(h),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.bk&&d.type==="QUOTA_EXCEEDED"?(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):kb("Playlist add error"),h.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,y,O));case 3:D=[];if(!l.fh.B("html5_offline_prevent_redownload_downloaded_video")){h.kT(7);break}return g.n(h,q2U(l.D,"mainVideoEntity",r),8);case 8:r=h.G;case 7:if((t=r)==null?0:t.length)for(U=g.b(r),G=U.next();!G.done;G=U.next())if(f=G.value,a=f.offlineVideoData,p=void 0,(p=a)==null?0:p.videoId)S=void 0,x=Number(((S=c.actionMetadata)==null?void 0:S.priority)||
0)+1,D.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"mainVideoEntity",x,gd,wTQ(c,a,k)));return h.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,D))}})},jJV=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN,R,v,z,w,V,cS,ry,ei,T,D5,bc,yn,KL,bQ,Q7,fU,LL,mJ,Dy,oa,L8,GE,Eu,Wu,gT,iM,f8,Km,PK,Tx,WM,M6,x_,YX,uM,rA,jp,AJ;
return g.H(function(Pu){switch(Pu.D){case 1:return Y=OF(c),X=c.entityKey,k=g.FN(X).entityId,r=[],e=!1,k==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.n(Pu,IK(l.D,"mainPlaylistEntity"),5)):g.n(Pu,FV(l.D,X,"mainPlaylistEntity"),4);case 4:(d=Pu.G)&&r.push(d);Pu.kT(3);break;case 5:r=Pu.G;case 3:if((y=r)==null||!y.length)return Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));O=g.m(c.actionMetadata,TRF);t=(D=O)==null?void 0:D.nextAutoRefreshIntervalSeconds;G=(U=O)==null?void 0:U.autoSync;f=[];p=a=
!0;S=!1;if(!e&&G===!1){Pu.kT(6);break}g.Rn(Pu,7);return g.n(Pu,EHc(0,!!G,!0,r),9);case 9:f=Pu.G;g.Si(Pu,8);break;case 7:x=g.vS(Pu);if(!(x instanceof Error&&x.message==="No data")){x instanceof Error&&x.message==="Empty response body"&&kb(x.message);Pu.kT(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.n(Pu,zji(l.D,c,l.K,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.n(Pu,vHe(k,l.D,c,l.K),8);case 8:if(!f.length||!e&&f[0].playlistId!==k)return Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));case 6:if(e){h=[];K=g.b(f);for(Q=K.next();!Q.done;Q=K.next())lc=Q.value,lc.upToDate||G&&!lc.shouldAutoSyncMetadata||!lc.playlistId||(E={nextAutoRefreshIntervalSeconds:lc.checkInSeconds,autoSync:G},h.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",lc.playlistId,"mainPlaylistEntity",0,gd,{mainPlaylistEntityActionMetadata:E})));return Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,h))}f.length&&(kv=f[0],S=!!kv.upToDate,G&&(a=(Jg=kv.shouldAutoSyncMetadata)!=null?Jg:!0,p=(I=kv.shouldAutoSyncVideos)!=
null?I:!0,kv.checkInSeconds&&(t=kv.checkInSeconds)));if(S||!a)return Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));W=[];F=r[0];if(!F.downloadState){q=void 0;Pu.kT(15);break}return g.n(Pu,FV(l.D,F.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:q=Pu.G;case 15:return M=q,SL=((mK=M)==null?0:mK.addedTimestampMillis)?String(M.addedTimestampMillis):void 0,g.Rn(Pu,17),g.n(Pu,H6F(l,k,SL,t),19);case 19:W=Pu.G;g.Si(Pu,18);break;case 17:PV=g.vS(Pu);if(!(PV instanceof Error&&
PV.message==="No data for playlist")){if(PV instanceof Error&&PV.message==="Empty response body for playlist")kb(PV.message);else return zO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",lQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",PV instanceof g.bk&&PV.type==="QUOTA_EXCEEDED"&&(zO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",lQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,zO,lQ));Pu.kT(18);
break}return g.n(Pu,vHe(k,l.D,c,l.K),18);case 18:if(!p)return Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));JE=[];qN=new Map;if((R=W)==null?0:R.length)for(v=g.b(W),z=v.next();!z.done;z=v.next())w=z.value,V=w.offlineVideoData,cS=void 0,((cS=V)==null?0:cS.videoId)&&qN.set(V.videoId,V);ry=new Map;ei=[];if((T=F)==null?0:(D5=T.videos)==null?0:D5.length)for(bc=g.b(F.videos),yn=bc.next();!yn.done;yn=bc.next())if(KL=yn.value,bQ=JSON.parse(g.FN(KL).entityId),Q7=bQ.videoId)qN.has(Q7)?(ry.set(Q7,
qN.get(Q7)),qN.delete(Q7)):ei.push(Q7);LL=Number(((fU=c.actionMetadata)==null?void 0:fU.priority)||0)+1;mJ=g.b(qN.entries());for(Dy=mJ.next();!Dy.done;Dy=mJ.next())oa=Dy.value,L8=g.b(oa),GE=L8.next().value,Eu=L8.next().value,Wu=GE,gT=Eu,JE.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Wu,"mainVideoEntity",LL,gd,wTQ(c,gT,k)));iM=g.b(ry.entries());for(f8=iM.next();!f8.done;f8=iM.next())Km=f8.value,PK=g.b(Km),Tx=PK.next().value,WM=PK.next().value,M6=Tx,x_=WM,JE.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
M6,"mainVideoEntity",LL,gd,wTQ(c,x_,k)));YX=g.b(ei);for(uM=YX.next();!uM.done;uM=YX.next())rA=uM.value,jp={playlistId:k},AJ={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:jp},JE.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",rA,"mainVideoEntity",0,gd,AJ));return Pu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,JE))}})},VqQ=function(l,c){var Y,X,k,r;
return g.H(function(e){switch(e.D){case 1:return Y=OF(c),g.Rn(e,2),X=g.FN(c.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.n(e,zji(l.D,c,l.K,(k=c.actionMetadata)==null?void 0:(r=k.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.n(e,vHe(X,l.D,c,l.K),6);case 6:if(!l.fh.B("woffle_enable_main_downloads_library")){e.kT(5);break}return g.n(e,j6Q(l.D,c.entityKey),5);case 5:g.Si(e,3);break;case 2:return g.vS(e),e.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},H6F=function(l,c,Y,X){var k,r,e,d,y,O,D;
return g.H(function(t){switch(t.D){case 1:return g.n(t,Bn6([c]),2);case 2:return k=t.G,g.n(t,oV6(l,k[0],Y,X),3);case 3:return r=t.G,e=r.mainPlaylistEntity,d=r.J5z,O=iOi(e,(y=d)==null?void 0:y.avatar),g.Rn(t,4),g.n(t,Rr(O),6);case 6:g.Si(t,5);break;case 4:D=g.vS(t),D instanceof Error&&D.message==="Failed to fetch"&&kb(D.message);case 5:return t.return(k[0].videos)}})},oV6=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K;
return g.H(function(Q){switch(Q.D){case 1:k=Date.now().toString();Y||(Y=k);r=c.videos;e=c.playlistId;d=[];y=[];if(r)for(O=g.b(r),D=O.next();!D.done;D=O.next()){t=D.value;U=t.offlineVideoData;if(!U||!U.videoId)throw kb("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");G=U.videoId;f={videoId:G,playlistId:e};a={id:g.I5(JSON.stringify(f),"mainPlaylistVideoEntity"),video:g.I5(G,"mainVideoEntity")};d.push(a);y.push(a.id)}S={key:g.I5(e,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Y,lastSyncedTimestampMillis:k};x={key:g.I5(e,"mainPlaylistEntity"),playlistId:e,videos:y,title:c.title,thumbnailStyleData:C6L(c),visibility:Z67(c),downloadState:S.key};c.channel&&(h=c.channel.offlineChannelData,p=$w7(g.I5(e,"ytMainChannelEntity"),h),x.channelOwner=p.id);((K=x)==null?0:K.entityMetadata)?(x.entityMetadata.offlineLastModifiedTimestampSeconds=c.lastModifiedTimestamp,X&&(x.entityMetadata.nextAutoRefreshIntervalSeconds=String(X))):x&&(x.entityMetadata={nextAutoRefreshIntervalSeconds:X?
String(X):void 0,offlineLastModifiedTimestampSeconds:c.lastModifiedTimestamp});g.Rn(Q,2);return g.n(Q,uK(l.D,{mode:"readwrite",b9:!0},function(lc){var E=B$(lc,x,"mainPlaylistEntity"),kv=B$(lc,S,"mainPlaylistDownloadStateEntity");E=[E,kv];kv=g.b(d);for(var Jg=kv.next();!Jg.done;Jg=kv.next())E.push(B$(lc,Jg.value,"mainPlaylistVideoEntity"));p&&E.push(B$(lc,p,"ytMainChannelEntity"));return g.SI.all(E)}),4);
case 4:g.Si(Q,3);break;case 2:throw g.vS(Q),kb("PES failure for playlist"),Error("PES failure for playlist");case 3:return Q.return({mainPlaylistEntity:x,J5z:p,YP6:d})}})},$w7=function(l,c){return{id:l,
channelId:c.channelId,title:c.title,avatar:c.thumbnail}},C6L=function(l){var c=[],Y=l.videos;
Y&&Y.length>0&&c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Y[0].offlineVideoData.thumbnail}}});if((l=l.additionalMetadadatas)&&l.length>0)for(l=g.b(l),Y=l.next();!Y.done;Y=l.next()){var X=Y.value.offlineBundleItemPlaylistData,k=void 0;Y=(k=X)==null?void 0:k.style;k=void 0;X={collageThumbnail:{coverThumbnail:(k=X)==null?void 0:k.coverThumbnail}};switch(Y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:X});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:X});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:X});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:X})}}return c},Z67=function(l){switch(l.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},wTQ=function(l,c,Y){c={offlineVideoData:c,
playlistId:Y};if(l=g.m(l.actionMetadata,TRF))c.maximumDownloadQuality=l.maximumDownloadQuality;return{mainVideoEntityActionMetadata:c}},QJN=function(l,c,Y){this.D=l;
this.fh=c;this.K=Y},MqQ=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f;
return g.H(function(a){switch(a.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,r=g.m(c.actionMetadata,uD),d=!((e=r)==null?0:e.playlistId),g.Rn(a,2),g.n(a,mwM(l,k,void 0,(y=r)==null?void 0:y.offlineVideoData,d),4);case 4:g.Si(a,3);break;case 2:return O=g.vS(a),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.bk&&O.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
a.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,D,t));case 3:U=1;U=Number(((G=c.actionMetadata)==null?void 0:G.priority)||0)+1;var p=(p=g.m(c.actionMetadata,uD))?{playbackDataActionMetadata:{maximumDownloadQuality:p.maximumDownloadQuality}}:void 0;f=Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",U,WCi,p);return a.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,[f]))}})},sJc=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x;
return g.H(function(h){switch(h.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,g.n(h,FV(l.D,c.entityKey,"mainVideoEntity"),2);case 2:r=h.G;if(!r){e=void 0;h.kT(3);break}return g.n(h,FV(l.D,r.downloadState,"mainVideoDownloadStateEntity"),4);case 4:e=h.G;case 3:d=e;if(!r||!d)return h.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.Rn(h,5);return g.n(h,mwM(l,k,d.addedTimestampMillis,(O=g.m(c.actionMetadata,uD))==null?void 0:O.offlineVideoData),7);case 7:D=1;D=Number(((t=
c.actionMetadata)==null?void 0:t.priority)||0)+1;y=Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",D,WCi);g.Si(h,6);break;case 5:U=g.vS(h);if(!(U instanceof Error&&U.message==="No data")){if(U instanceof Error&&U.message==="Empty response body")kb(U.message);else return G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.bk&&U.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,G,f));h.kT(6);break}return g.n(h,vt(l.D,k),9);case 9:a=h.G;p=g.m(c.actionMetadata,uD);if(x=(S=p)==null?void 0:S.playlistId)a.playlistId=x;a.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.n(h,iD(k,l.D,c,l.K,a),6);case 6:return h.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,y?[y]:void 0))}})},BRN=function(l,c){var Y,X,k,r,e,d,y,O,D,t;
return g.H(function(U){switch(U.D){case 1:return Y=OF(c),g.Rn(U,2),X=g.FN(c.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.n(U,zji(l.D,c,l.K,(D=c.actionMetadata)==null?void 0:(t=D.offlineLoggingData)==null?void 0:t.offlineDeleteReason),5):g.n(U,vt(l.D,X),6);case 6:k=U.G;r=g.m(c.actionMetadata,uD);if(d=(e=r)==null?void 0:e.playlistId)k.playlistId=d;k.offlineDeleteReason=(y=c.actionMetadata)==null?void 0:(O=y.offlineLoggingData)==null?void 0:O.offlineDeleteReason;return g.n(U,iD(X,l.D,c,l.K,k),7);
case 7:if(!l.fh.B("woffle_enable_main_downloads_library")){U.kT(5);break}return g.n(U,j6Q(l.D,c.entityKey),5);case 5:g.Si(U,3);break;case 2:return g.vS(U),U.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},mwM=function(l,c,Y,X,k){var r,e,d,y,O,D;
return g.H(function(t){switch(t.D){case 1:if(r=X){t.kT(2);break}return g.n(t,s66([c]),3);case 3:e=t.G,r=e[0];case 2:return g.n(t,LCN(l,r,Y,k),4);case 4:d=t.G;y=d.mainVideoEntity;O=d.channelEntity;g.Rn(t,5);var U=bD(y.thumbnail),G=bD(O.avatar);return g.n(t,Rr(U.concat(G)),7);case 7:g.Si(t,0);break;case 5:D=g.vS(t),D instanceof Error&&D.message==="Failed to fetch"&&kb(D.message),g.pL(t)}})},LCN=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U,G,f,a,p;
return g.H(function(S){switch(S.D){case 1:Y||(Y=Date.now().toString());r=(k=c.channel)==null?void 0:k.offlineChannelData;e={id:g.I5(c.videoId,"ytMainChannelEntity"),channelId:r.channelId,title:r.title,avatar:r.thumbnail};d={key:g.I5(c.videoId,"mainVideoDownloadStateEntity"),playbackData:g.I5(c.videoId,"playbackData"),addedTimestampMillis:Y,videoDownloadContextEntity:g.I5(c.videoId,"videoDownloadContextEntity")};y={key:g.I5(c.videoId,"videoPlaybackPositionEntity"),videoId:c.videoId,lastPlaybackPositionSeconds:"0"};
l.fh.B("html5_offline_playback_position_sync")&&(O={playbackPosition:y.key});D=g.I5(c.videoId,"mainVideoEntity");t={key:D,videoId:c.videoId,title:c.title,thumbnail:c.thumbnail,localizedStrings:{viewCount:c.shortViewCountText},userState:O,lengthSeconds:c.lengthSeconds?Number(c.lengthSeconds):void 0,publishedTimestampMillis:c.publishedTimestamp?(Number(c.publishedTimestamp)*1E3).toString():void 0,formattedDescription:c.description,owner:e.id,downloadState:d.key};if(!l.fh.B("woffle_enable_main_downloads_library")||
!X){S.kT(2);break}return g.n(S,K0M(l.D,[D]),3);case 3:if(f=S.G)U=f.mainDownloadsLibraryEntity,G=f.mainDownloadsListEntity;case 2:return p=bOU,a={key:g.I5(c.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.WR(d,p,a),g.n(S,uK(l.D,{mode:"readwrite",b9:!0},function(x){var h=B$(x,e,"ytMainChannelEntity"),K=B$(x,d,"mainVideoDownloadStateEntity"),Q=B$(x,t,"mainVideoEntity");h=[h,K,Q];l.fh.B("html5_offline_playback_position_sync")&&(K=B$(x,y,"videoPlaybackPositionEntity"),
h.push(K));U&&(K=B$(x,U,"mainDownloadsLibraryEntity"),h.push(K));G&&(K=B$(x,G,"mainDownloadsListEntity"),h.push(K));a&&(x=B$(x,a,"downloadStatusEntity"),h.push(x));return g.SI.all(h)}),4);
case 4:return S.return({mainVideoEntity:t,channelEntity:e})}})},EVe=function(l,c,Y){this.D=l;
this.fh=c;this.K=Y},uO6=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F;
return g.H(function(q){switch(q.D){case 1:return Y=OF(c),X=[],g.n(q,$d.getInstance(),2);case 2:k=q.G;if(!k){q.kT(3);break}return g.n(q,k.get("sdois"),4);case 4:return r=q.G,g.n(q,(d=k)==null?void 0:d.get("lmqf"),5);case 5:e=q.G;case 3:g.Rn(q,6);if(r===void 0)throw Error("prefStorage or opt-in state is undefined");y=[];if(r){q.kT(8);break}return g.n(q,wPi(l.D),9);case 9:y=q.G,y.reverse();case 8:if(!y.length){q.kT(10);break}O=g.b(y);D=O.next();case 11:if(D.done){q.kT(10);break}t=D.value;if(!t){q.kT(12);
break}U=g.FN(t).entityId;return g.n(q,vt(l.D,U),14);case 14:return G=q.G,G.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.n(q,iD(U,l.D,{entityKey:t,actionType:c.actionType},l.K,G),12);case 12:D=O.next();q.kT(11);break;case 10:return g.n(q,u5F(r,(f=e)!=null?f:"SD"),16);case 16:return a=q.G,g.n(q,nHQ(a),17);case 17:p=HOM(a);if(!l.fh.B("woffle_enable_main_downloads_library")){q.kT(18);break}if(r){q.kT(19);break}return g.n(q,j6Q(l.D,g.KK),19);case 19:return g.n(q,TnN(l.D,[g.KK]),18);
case 18:if((S=p)==null?0:S.length)for(x=g.b(p),h=x.next();!h.done;h=x.next())if(Q=K=h.value,lc=Q.actionType,E=Q.entityKey,kv=Q.actionMetadata,lc&&E&&kv&&!g.m(kv,gVc)){lc==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(kv.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Jg=g.m(K.actionMetadata,uD))Jg.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",K.actionMetadata=Object.assign({},K.actionMetadata,{mainVideoEntityActionMetadata:Jg});X.push(K)}g.Si(q,7);break;
case 6:return I=g.vS(q),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.bk&&I.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,W,F));case 7:return q.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,X))}})},AjQ=function(){Ld.apply(this,arguments);
this.j="mainVideoEntity"},FCN=function(l,c,Y){c=c===void 0?43200:c;
Y=Y===void 0?!0:Y;var X=X===void 0?!1:X;var k,r,e;return g.H(function(d){switch(d.D){case 1:if(!l.W.Hp())return d.return([]);k=[];g.Rn(d,2);return g.n(d,EHc(c,Y,X),4);case 4:k=d.G;g.Si(d,3);break;case 2:r=g.vS(d),r instanceof Error&&r.message==="No data"||r instanceof Error&&r.message==="Empty response body"&&kb(r.message);case 3:return e=zON(l,k,Y,"mainPlaylistEntity"),d.return(e)}})},IK6=function(l,c,Y,X){X=X===void 0?!1:X;
var k,r,e,d,y,O,D,t,U,G,f,a,p,S,x;return g.H(function(h){switch(h.D){case 1:return k=[],g.n(h,gHF(),2);case 2:return(r=h.G)||X?g.n(h,ATV(c,Y),3):h.return([]);case 3:e=h.G;if((d=e)==null||!d.length)return h.return([]);y={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};O=g.b(e);D=O.next();case 4:if(D.done){h.kT(6);break}U=t=D.value;G=U.actionType;f=U.entityKey;a=U.actionMetadata;if(!(G&&f&&a)||g.m(a,gVc)){h.kT(5);break}G==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.offlineLoggingData=
y);p=g.FN(f);S=p.entityId;return g.n(h,EF(l,[S],"mainVideoEntity",G,a),8);case 8:x=h.G,k=k.concat(x);case 5:D=O.next();h.kT(4);break;case 6:return h.return(k)}})},lYc=function(l,c){this.D=l;
this.K=c},YSe=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S;
return g.H(function(x){switch(x.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,r=[],g.Rn(x,2),g.n(x,cJV(l,k),4);case 4:r=x.G;if((e=r)==null||!e.length){x.kT(5);break}return g.n(x,$F6(l.D,c.entityKey),5);case 5:g.Si(x,3);break;case 2:return d=g.vS(x),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.bk&&d.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
x.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,y,O));case 3:return D=[],g.n(x,q2U(l.D,"musicTrack",r),7);case 7:r=x.G;if(r.length)for(t=g.b(r),U=t.next();!U.done;U=t.next())if(G=U.value,f=G.offlineVideoData,a=void 0,(a=f)==null?0:a.videoId)p=void 0,S=Number(((p=c.actionMetadata)==null?void 0:p.priority)||0)+1,D.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",f.videoId,"musicTrack",S,AI,hI(c,f,k)));return x.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,D))}})},
Xpc=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN,R,v,z,w,V,cS,ry,ei,T,D5,bc,yn,KL,bQ,Q7,fU,LL,mJ,Dy,oa,L8,GE,Eu;
return g.H(function(Wu){switch(Wu.D){case 1:return Y=OF(c),X=c.entityKey,k=g.FN(X).entityId,r=[],e=!1,k==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.n(Wu,IK(l.D,"musicAlbumRelease"),5)):g.n(Wu,FV(l.D,X,"musicAlbumRelease"),4);case 4:(d=Wu.G)&&r.push(d);Wu.kT(3);break;case 5:r=Wu.G;case 3:if((y=r)==null||!y.length)return Wu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));if(e){O=[];D=g.b(r);for(t=D.next();!t.done;t=D.next())U=t.value,G=g.FN(U.id).entityId,O.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
G,"musicAlbumRelease",0,AI));return Wu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,O))}f=[];a=r[0];p=void 0;if(!a.downloadMetadata){Wu.kT(6);break}return g.n(Wu,FV(l.D,a.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:S=Wu.G,p=Number((h=(x=S)==null?void 0:x.addedTimestampMillis)!=null?h:"0")/1E3;case 6:return g.Rn(Wu,8),g.n(Wu,cJV(l,k,(K=p)==null?void 0:K.toString()),10);case 10:f=Wu.G;g.Si(Wu,9);break;case 8:Q=g.vS(Wu);if(!(Q instanceof Error&&Q.message===
"No data")){if(Q instanceof Error&&Q.message==="Empty response body")kb(Q.message);else return lc="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.bk&&Q.type==="QUOTA_EXCEEDED"&&(lc="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Wu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,lc,E));Wu.kT(9);break}return g.n(Wu,zr(k,"musicAlbumRelease",
l.D,c,l.K),9);case 9:kv=[];Jg=new Map;if((I=f)==null?0:I.length)for(W=g.b(f),F=W.next();!F.done;F=W.next())q=F.value,M=q.offlineVideoData,mK=void 0,((mK=M)==null?0:mK.videoId)&&Jg.set(M.videoId,M);SL=new Map;PV=[];if((zO=a)==null?0:(lQ=zO.tracks)==null?0:lQ.length)for(JE=g.b(a.tracks),qN=JE.next();!qN.done;qN=JE.next())if(R=qN.value,v=g.FN(R).entityId)Jg.has(v)?(SL.set(v,Jg.get(v)),Jg.delete(v)):PV.push(v);w=Number(((z=c.actionMetadata)==null?void 0:z.priority)||0)+1;V=g.b(Jg.entries());for(cS=V.next();!cS.done;cS=
V.next())ry=cS.value,ei=g.b(ry),T=ei.next().value,D5=ei.next().value,bc=T,yn=D5,kv.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",bc,"musicTrack",w,AI,hI(c,yn)));KL=g.b(SL.entries());for(bQ=KL.next();!bQ.done;bQ=KL.next())Q7=bQ.value,fU=g.b(Q7),LL=fU.next().value,mJ=fU.next().value,Dy=LL,oa=mJ,kv.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Dy,"musicTrack",w,AI,hI(c,oa)));L8=g.b(PV);for(GE=L8.next();!GE.done;GE=L8.next())Eu=GE.value,kv.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Eu,
"musicTrack",0,AI));return Wu.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,kv))}})},kLU=function(l,c){var Y,X;
return g.H(function(k){switch(k.D){case 1:return Y=OF(c),g.Rn(k,2),X=g.FN(c.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.n(k,nd(l.D,c,l.K),5):g.n(k,zr(X,"musicAlbumRelease",l.D,c,l.K),6);case 6:return g.n(k,Q6a(l.D,c.entityKey),5);case 5:g.Si(k,3);break;case 2:return g.vS(k),k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},cJV=function(l,c,Y){var X,k,r;
return g.H(function(e){switch(e.D){case 1:return g.n(e,Bn6([c]),2);case 2:return X=e.G,g.n(e,rJe(l,X[0],Y),3);case 3:return k=e.G,r=bD(k.thumbnailDetails),g.n(e,Rr(r),4);case 4:return e.return(X[0].videos)}})},rJe=function(l,c,Y){var X,k,r,e,d,y,O,D,t,U,G,f,a,p;
return g.H(function(S){if(S.D==1){X=c.additionalMetadadatas;k=void 0;if(X&&X.length>0)for(r=g.b(X),e=r.next();!e.done;e=r.next())if(d=e.value,d.offlineMusicPlaylistData){k=d.offlineMusicPlaylistData;break}y=c.playlistId;O=mFM(c);D=O.W3;t=O.lc;U=Y?(Number(Y)*1E3).toString():Date.now().toString();G=c.lastModifiedTimestamp?(Number(c.lastModifiedTimestamp)*1E3).toString():"0";f={id:g.I5(y,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:t,lastModifiedTimestampMillis:G,addedTimestampMillis:U,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};a={id:g.I5(y,"musicAlbumRelease"),title:c.title,audioPlaylistId:y,trackCount:c.totalVideoCount,tracks:D,downloadMetadata:f.id};k&&(a.thumbnailDetails=(p=k.albumHqThumbnail)!=null?p:k.albumArtistThumbnail,a.artistDisplayName=k.albumArtistDisplayName,a.releaseDate=k.albumReleaseDate,a.contentRating={explicitType:k.albumReleaseExplicitType},a.releaseType=k.albumReleaseType);return g.n(S,uK(l.D,{mode:"readwrite",b9:!0},function(x){var h=B$(x,a,"musicAlbumRelease");
x=B$(x,f,"musicAlbumReleaseDownloadMetadataEntity");return g.SI.all([h,x])}),2)}return S.return(a)})},et6=function(l,c){this.D=l;
this.K=c},dmc=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S;
return g.H(function(x){switch(x.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,r=[],g.Rn(x,2),g.n(x,JJi(l,k),4);case 4:r=x.G;if((e=r)==null||!e.length){x.kT(5);break}return g.n(x,$F6(l.D,c.entityKey),5);case 5:g.Si(x,3);break;case 2:return d=g.vS(x),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.bk&&d.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
x.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,y,O));case 3:return D=[],g.n(x,q2U(l.D,"musicTrack",r),7);case 7:r=x.G;if(r.length)for(t=g.b(r),U=t.next();!U.done;U=t.next())if(G=U.value,f=G.offlineVideoData,a=void 0,(a=f)==null?0:a.videoId)p=void 0,S=Number(((p=c.actionMetadata)==null?void 0:p.priority)||0)+1,D.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",f.videoId,"musicTrack",S,FI,hI(c,f,k)));return x.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,D))}})},
yJa=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN,R,v,z,w,V,cS,ry,ei,T,D5,bc,yn,KL,bQ,Q7,fU,LL,mJ,Dy,oa,L8,GE,Eu,Wu,gT,iM,f8,Km,PK,Tx,WM,M6,x_,YX,uM;
return g.H(function(rA){switch(rA.D){case 1:return Y=OF(c),X=c.entityKey,k=g.FN(X).entityId,r=[],e=!1,k==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.n(rA,IK(l.D,"musicPlaylist"),5)):g.n(rA,FV(l.D,X,"musicPlaylist"),4);case 4:(d=rA.G)&&r.push(d);rA.kT(3);break;case 5:r=rA.G;case 3:if((y=r)==null||!y.length)return rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));O=g.m(c.actionMetadata,W0i);t=(D=O)==null?void 0:D.autoSync;U=[];f=G=!0;a=!1;p=void 0;if(!e&&t===!1){rA.kT(6);break}g.Rn(rA,7);return g.n(rA,
F0Q(0,!!t,!0,r),9);case 9:U=rA.G;g.Si(rA,8);break;case 7:S=g.vS(rA);if(!(S instanceof Error&&S.message==="No data")){S instanceof Error&&S.message==="Empty response body"&&kb(S.message);rA.kT(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.n(rA,nd(l.D,c,l.K),8):g.n(rA,zr(k,"musicPlaylist",l.D,c,l.K),8);case 8:if(!U.length||!e&&U[0].playlistId!==k)return rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));case 6:if(e){x=[];h=g.b(U);for(K=h.next();!K.done;K=h.next())Q=K.value,Q.upToDate||
t&&!Q.shouldAutoSyncMetadata||!Q.playlistId||(lc={autoSync:t},x.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q.playlistId,"musicPlaylist",0,FI,{musicPlaylistEntityActionMetadata:lc})));return rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,x))}U.length&&(E=U[0],a=!!E.upToDate,t&&(G=(kv=E.shouldAutoSyncMetadata)!=null?kv:!0,f=(Jg=E.shouldAutoSyncVideos)!=null?Jg:!0,E.checkInSeconds&&(p=E.checkInSeconds)));if(a||!G)return rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));I=[];W=r[0];F=void 0;if(!W.downloadMetadata){rA.kT(15);break}return g.n(rA,FV(l.D,W.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:q=rA.G,F=Number((mK=(M=q)==null?void 0:M.addedTimestampMillis)!=null?mK:"0")/1E3;case 15:return g.Rn(rA,17),g.n(rA,JJi(l,k,(SL=F)==null?void 0:SL.toString(),p),19);case 19:I=rA.G;g.Si(rA,18);break;case 17:PV=g.vS(rA);if(!(PV instanceof Error&&PV.message==="No data")){if(PV instanceof Error&&PV.message==="Empty response body")kb(PV.message);else return zO=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",lQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",PV instanceof g.bk&&PV.type==="QUOTA_EXCEEDED"&&(zO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",lQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,zO,lQ));rA.kT(18);break}return g.n(rA,zr(k,"musicPlaylist",l.D,c,l.K),18);case 18:if(!f)return rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));JE=[];qN=new Map;if((R=I)==null?0:R.length)for(v=g.b(I),z=v.next();!z.done;z=v.next())w=z.value,V=w.offlineVideoData,cS=void 0,((cS=V)==null?0:cS.videoId)&&qN.set(V.videoId,V);ry=new Map;ei=[];if((T=W)==null?0:(D5=T.tracks)==null?0:D5.length)for(bc=g.b(W.tracks),yn=bc.next();!yn.done;yn=bc.next())if(KL=yn.value,bQ=g.FN(KL).entityId)qN.has(bQ)?(ry.set(bQ,qN.get(bQ)),qN.delete(bQ)):ei.push(bQ);fU=Number(((Q7=c.actionMetadata)==null?void 0:Q7.priority)||0)+1;LL=g.b(qN.entries());for(mJ=LL.next();!mJ.done;mJ=
LL.next())Dy=mJ.value,oa=g.b(Dy),L8=oa.next().value,GE=oa.next().value,Eu=L8,Wu=GE,JE.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Eu,"musicTrack",fU,FI,hI(c,Wu)));gT=g.b(ry.entries());for(iM=gT.next();!iM.done;iM=gT.next())f8=iM.value,Km=g.b(f8),PK=Km.next().value,Tx=Km.next().value,WM=PK,M6=Tx,JE.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",WM,"musicTrack",fU,FI,hI(c,M6)));x_=g.b(ei);for(YX=x_.next();!YX.done;YX=x_.next())uM=YX.value,JE.push(Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
uM,"musicTrack",0,FI));return rA.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,JE))}})},OnF=function(l,c){var Y,X;
return g.H(function(k){switch(k.D){case 1:return Y=OF(c),g.Rn(k,2),X=g.FN(c.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.n(k,nd(l.D,c,l.K),5):g.n(k,zr(X,"musicPlaylist",l.D,c,l.K),6);case 6:return g.n(k,Q6a(l.D,c.entityKey),5);case 5:g.Si(k,3);break;case 2:return g.vS(k),k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},JJi=function(l,c,Y,X){var k,r,e;
return g.H(function(d){switch(d.D){case 1:return g.n(d,Bn6([c]),2);case 2:return k=d.G,g.n(d,DmU(l,k[0],Y,X),3);case 3:return r=d.G,e=bD(r.thumbnailDetails),g.n(d,Rr(e),4);case 4:return d.return(k[0].videos)}})},DmU=function(l,c,Y,X){var k,r,e,d,y,O,D,t,U;
return g.H(function(G){return G.D==1?(k=c.playlistId,r=mFM(c),e=r.W3,d=r.lc,y=Y?(Number(Y)*1E3).toString():Date.now().toString(),O=c.lastModifiedTimestamp?(Number(c.lastModifiedTimestamp)*1E3).toString():"0",D={id:g.I5(k,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:d,lastModifiedTimestampMillis:O,addedTimestampMillis:y,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},t={id:g.I5(k,"musicPlaylist"),title:c.title,playlistId:k,thumbnailDetails:c.thumbnail,visibility:trU(c),trackCount:c.totalVideoCount,
tracks:e,downloadMetadata:D.id},X&&(((U=t)==null?0:U.entityMetadata)?t.entityMetadata.nextAutoRefreshIntervalSeconds=String(X):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:String(X)})),g.n(G,uK(l.D,{mode:"readwrite",b9:!0},function(f){var a=B$(f,t,"musicPlaylist");f=B$(f,D,"musicPlaylistDownloadMetadataEntity");return g.SI.all([a,f])}),2)):G.return(t)})},trU=function(l){switch(l.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},UmQ=function(l,c){this.D=l;
this.K=c},bn6=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f;
return g.H(function(a){switch(a.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,r=g.m(c.actionMetadata,GLF),g.Rn(a,2),g.n(a,fYc(l,k,void 0,(e=r)==null?void 0:e.track,(d=r)==null?void 0:d.albumRelease),4);case 4:if((y=r)==null?0:y.playlistId){a.kT(5);break}return g.n(a,$F6(l.D,c.entityKey),5);case 5:g.Si(a,3);break;case 2:return O=g.vS(a),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.bk&&O.type==="QUOTA_EXCEEDED"&&
(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,D,t));case 3:G=Number(((U=c.actionMetadata)==null?void 0:U.priority)||0)+1;var p=(p=g.m(c.actionMetadata,GLF))?{playbackDataActionMetadata:{maximumDownloadQuality:p.maximumDownloadQuality}}:void 0;f=Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",G,Ph7,p);return a.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y,[f]))}})},qSN=function(l,c){var Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p;
return g.H(function(S){switch(S.D){case 1:return Y=OF(c),X=g.FN(c.entityKey),k=X.entityId,g.n(S,FV(l.D,c.entityKey,"musicTrack"),2);case 2:r=S.G;if(!r){e=void 0;S.kT(3);break}return g.n(S,FV(l.D,r.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:e=S.G;case 3:d=e;if(!r||!d)return S.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));O=g.m(c.actionMetadata,GLF);g.Rn(S,5);return g.n(S,fYc(l,k,d.addedTimestampMillis,(D=O)==null?void 0:D.track,(t=O)==null?void 0:t.albumRelease),
7);case 7:G=Number(((U=c.actionMetadata)==null?void 0:U.priority)||0)+1;y=Tr("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",G,Ph7);g.Si(S,6);break;case 5:f=g.vS(S);if(!(f instanceof Error&&f.message==="No data")){if(f instanceof Error&&f.message==="Empty response body")kb(f.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.bk&&f.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,a,p));S.kT(6);break}return g.n(S,xb(k,l.D,c,l.K),6);case 6:return S.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,y?[y]:void 0))}})},aYQ=function(l,c){var Y,X;
return g.H(function(k){switch(k.D){case 1:return Y=OF(c),g.Rn(k,2),X=g.FN(c.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.n(k,nd(l.D,c,l.K),5):g.n(k,xb(X,l.D,c,l.K),6);case 6:return g.n(k,Q6a(l.D,c.entityKey),5);case 5:g.Si(k,3);break;case 2:return g.vS(k),k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new jw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},fYc=function(l,c,Y,X,k){var r,e,d,y,O,D;
return g.H(function(t){switch(t.D){case 1:if(r=X){t.kT(2);break}return g.n(t,s66([c]),3);case 3:e=t.G,d=e[0],r=ZOi(d);case 2:return g.n(t,NfE(l,r,c,k,Y),4);case 4:y=t.G;O=y.musicTrackEntity;D=y.hS;var U=bD(O.thumbnailDetails),G=[];D&&(G=bD(D.thumbnailDetails));return g.n(t,Rr(U.concat(G)),0)}})},NfE=function(l,c,Y,X,k){var r;
return g.H(function(e){return e.D==1?(k||(k=Date.now().toString()),r={id:g.I5(Y,"musicTrackDownloadMetadataEntity"),playbackData:g.I5(Y,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.I5(Y,"videoDownloadContextEntity")},X&&(c.albumRelease=X.id),g.n(e,uK(l.D,{mode:"readwrite",b9:!0},function(d){var y=[],O=B$(d,r,"musicTrackDownloadMetadataEntity");y.push(O);O=B$(d,c,"musicTrack");y.push(O);X&&(d=B$(d,X,"musicAlbumRelease"),y.push(d));return g.SI.all(y)}),2)):e.D!=3?g.n(e,Gr(Y,"musicTrackDownloadMetadataEntity",
l.D,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):e.return({musicTrackEntity:c,
hS:X})})},Ir=function(){Ld.apply(this,arguments);
this.j="musicTrack"},ppa=function(l,c,Y){c=c===void 0?43200:c;
Y=Y===void 0?!0:Y;var X=X===void 0?!1:X;var k,r;return g.H(function(e){switch(e.D){case 1:if(!l.W.Hp())return e.return([]);k=[];g.Rn(e,2);return g.n(e,F0Q(c,Y,X),4);case 4:k=e.G;g.Si(e,3);break;case 2:g.vS(e);case 3:return r=zON(l,k,Y,"musicPlaylist"),e.return(r)}})},Rtc=function(){g.GH.apply(this,arguments);
var l=this;this.events=new g.Cr(this);this.fh=this.player.L();this.gk={yET:function(){return l.D},
dc:function(){return l.dc()},
Ku:function(c){return l.Ku(c)}}},inN=function(l){var c;
l=g.m((c=l.getWatchNextResponse())==null?void 0:c.currentVideoEndpoint,g.lG);if(l==null?0:l.playlistId)var Y=l.playlistId;return Y},SSc=function(l,c){var Y,X,k,r;
return g.H(function(e){if(e.D==1){Y=c.clientPlaybackNonce;X={cpn:Y,offlineSourceVisualElement:g.vR(c.PU||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};c.G&&(X.videoFmt=Number(c.G.itag));c.T&&(X.audioFmt=Number(c.T.itag));if((k=inN(c))&&c.videoId){var d=c.videoId;d=k!=="PPSV"?Promise.resolve(!1):l.D.QZ(d);e=g.n(e,d,3)}else e=e.kT(2);return e}e.D!=2&&(r=e.G)&&(X.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");l.G=Y;g.Oq("offlinePlaybackStarted",X);g.pL(e)})};
g.nX.prototype.fN=g.dy(51,function(l){return this.app.fN(l)});
g.Pk.prototype.fN=g.dy(50,function(l){return g.gbi(this,9,l)});
g.P(CT,oK);g.OV.Object.defineProperties(CT.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.D.entityMetadata},
set:function(l){this.D.entityMetadata=l}}});
g.P(qUQ,CT);qUQ.prototype.G=function(){return[]};
g.P(arQ,CT);arQ.prototype.G=function(){return[]};
g.P(N0a,CT);N0a.prototype.G=function(){return[]};
g.P(pMQ,CT);pMQ.prototype.G=function(){return[]};
g.P(Raa,CT);Raa.prototype.G=function(){var l=[];this.D.alternateChannel&&l.push(this.D.alternateChannel);this.D.alternateChannelList&&l.push.apply(l,g.N(this.D.alternateChannelList));this.D.oneofChannelEntity&&l.push(this.D.oneofChannelEntity);return[].concat(g.N(new Set(l)))};
g.P(iRV,CT);iRV.prototype.G=function(){var l=[];this.D.entryCollection&&l.push(this.D.entryCollection);return[].concat(g.N(new Set(l)))};
g.P(SUU,oK);SUU.prototype.G=function(){var l=[];this.D.video&&l.push(this.D.video);return[].concat(g.N(new Set(l)))};
g.P(vkN,CT);vkN.prototype.G=function(){var l=[];this.D.parentPlaylist&&l.push(this.D.parentPlaylist);if(this.D.entries)for(var c=g.b(this.D.entries),Y=c.next();!Y.done;Y=c.next())l.push.apply(l,g.N((new SUU(Y.value)).G()));return[].concat(g.N(new Set(l)))};
g.P(x6N,CT);x6N.prototype.G=function(){var l=[];this.D.descriptionEntity&&l.push(this.D.descriptionEntity);this.D.creators&&l.push.apply(l,g.N(this.D.creators));this.D.theBiggestFan&&l.push(this.D.theBiggestFan);return[].concat(g.N(new Set(l)))};
g.P(zaE,CT);zaE.prototype.G=function(){return[]};
g.P(nkM,CT);nkM.prototype.G=function(){return[]};
g.P(haN,CT);haN.prototype.G=function(){return[]};
g.P(HRM,CT);HRM.prototype.G=function(){return[]};
g.P(wMa,CT);wMa.prototype.G=function(){return[]};
g.P(KDi,CT);KDi.prototype.G=function(){return[]};
g.P(T0L,CT);T0L.prototype.G=function(){return[]};
g.P(jpE,CT);jpE.prototype.G=function(){return[]};
g.P(VHQ,CT);VHQ.prototype.G=function(){return[]};
g.P(ok6,CT);ok6.prototype.G=function(){var l=[];this.D.downloadsList&&l.push(this.D.downloadsList);this.D.smartDownloadsList&&l.push(this.D.smartDownloadsList);this.D.recommendedDownloadsList&&l.push(this.D.recommendedDownloadsList);this.D.refresh&&l.push(this.D.refresh);return[].concat(g.N(new Set(l)))};
g.P(Cj6,oK);Cj6.prototype.G=function(){var l=[];this.D.video&&l.push(this.D.video);this.D.playlist&&l.push(this.D.playlist);this.D.videoItem&&l.push(this.D.videoItem);this.D.playlistItem&&l.push(this.D.playlistItem);return[].concat(g.N(new Set(l)))};
g.P(ZRQ,CT);ZRQ.prototype.G=function(){var l=[];this.D.refresh&&l.push(this.D.refresh);if(this.D.downloads)for(var c=g.b(this.D.downloads),Y=c.next();!Y.done;Y=c.next())l.push.apply(l,g.N((new Cj6(Y.value)).G()));return[].concat(g.N(new Set(l)))};
g.P($6c,CT);$6c.prototype.G=function(){var l=[];this.D.localImageEntities&&l.push.apply(l,g.N(this.D.localImageEntities));return[].concat(g.N(new Set(l)))};
g.P(QpL,CT);QpL.prototype.G=function(){var l=[];this.D.playbackData&&l.push(this.D.playbackData);this.D.localImageEntities&&l.push.apply(l,g.N(this.D.localImageEntities));this.D.videoDownloadContextEntity&&l.push(this.D.videoDownloadContextEntity);return[].concat(g.N(new Set(l)))};
g.P(m6N,CT);m6N.prototype.G=function(){return[]};
g.P(WDU,CT);WDU.prototype.G=function(){var l=[];this.D.fakeChildren&&l.push.apply(l,g.N(this.D.fakeChildren));return[].concat(g.N(new Set(l)))};
g.P(MHV,CT);MHV.prototype.G=function(){var l=[];this.D.video&&l.push(this.D.video);this.D.playbackData&&l.push(this.D.playbackData);this.D.offlineVideoPolicy&&l.push(this.D.offlineVideoPolicy);return[].concat(g.N(new Set(l)))};
g.P(spL,CT);spL.prototype.G=function(){return[]};
g.P(B07,CT);B07.prototype.G=function(){var l=[];this.D.channelOwner&&l.push(this.D.channelOwner);this.D.videos&&l.push.apply(l,g.N(this.D.videos));this.D.collaboratorChannels&&l.push.apply(l,g.N(this.D.collaboratorChannels));this.D.downloadState&&l.push(this.D.downloadState);this.D.refresh&&l.push(this.D.refresh);return[].concat(g.N(new Set(l)))};
g.P(LDV,CT);LDV.prototype.G=function(){var l=[];this.D.video&&l.push(this.D.video);this.D.channelContributor&&l.push(this.D.channelContributor);return[].concat(g.N(new Set(l)))};
g.P(EkF,oK);EkF.prototype.G=function(){var l=[];this.D.localImageEntities&&l.push.apply(l,g.N(this.D.localImageEntities));this.D.videoDownloadContextEntity&&l.push(this.D.videoDownloadContextEntity);return[].concat(g.N(new Set(l)))};
g.P(gkQ,oK);gkQ.prototype.G=function(){var l=[];this.D.recommendedVideoMetadata&&l.push.apply(l,g.N((new EkF(this.D.recommendedVideoMetadata)).G()));return[].concat(g.N(new Set(l)))};
g.P(u2V,oK);u2V.prototype.G=function(){var l=[];this.D.playbackPosition&&l.push(this.D.playbackPosition);return[].concat(g.N(new Set(l)))};
g.P(AYQ,CT);AYQ.prototype.G=function(){var l=[];this.D.owner&&l.push(this.D.owner);this.D.downloadState&&l.push(this.D.downloadState);this.D.userState&&l.push.apply(l,g.N((new u2V(this.D.userState)).G()));this.D.additionalMetadata&&l.push.apply(l,g.N((new gkQ(this.D.additionalMetadata)).G()));return[].concat(g.N(new Set(l)))};
g.P(FDe,CT);FDe.prototype.G=function(){var l=[];this.D.userChannelDetails&&l.push(this.D.userChannelDetails);return[].concat(g.N(new Set(l)))};
g.P(Ire,CT);Ire.prototype.G=function(){var l=[];this.D.channelOwner&&l.push(this.D.channelOwner);this.D.playbackPosition&&l.push(this.D.playbackPosition);this.D.localImageEntities&&l.push.apply(l,g.N(this.D.localImageEntities));this.D.downloadStatus&&l.push(this.D.downloadStatus);return[].concat(g.N(new Set(l)))};
g.P(lBM,CT);lBM.prototype.G=function(){return[]};
g.P(csM,CT);csM.prototype.G=function(){return[]};
g.P(YE7,CT);YE7.prototype.G=function(){return[]};
g.P(XLa,CT);XLa.prototype.G=function(){return[]};
g.P(kiN,CT);kiN.prototype.G=function(){return[]};
g.P(rsN,CT);rsN.prototype.G=function(){return[]};
g.P(eTc,CT);eTc.prototype.G=function(){return[]};
g.P(Js7,CT);Js7.prototype.G=function(){return[]};
g.P(dti,CT);dti.prototype.G=function(){return[]};
g.P(ysQ,CT);ysQ.prototype.G=function(){return[]};
g.P(OI7,CT);OI7.prototype.G=function(){return[]};
g.P(DtU,CT);DtU.prototype.G=function(){var l=[];this.D.trackDownloadMetadatas&&l.push.apply(l,g.N(this.D.trackDownloadMetadatas));return[].concat(g.N(new Set(l)))};
g.P(t2c,CT);
t2c.prototype.G=function(){var l=[];this.D.downloadedTracks&&l.push.apply(l,g.N(this.D.downloadedTracks));this.D.smartDownloadedTracks&&l.push.apply(l,g.N(this.D.smartDownloadedTracks));this.D.downloadedEpisodes&&l.push.apply(l,g.N(this.D.downloadedEpisodes));this.D.downloadedAlbumReleases&&l.push.apply(l,g.N(this.D.downloadedAlbumReleases));this.D.smartDownloadedAlbumReleases&&l.push.apply(l,g.N(this.D.smartDownloadedAlbumReleases));this.D.downloadedPlaylists&&l.push.apply(l,g.N(this.D.downloadedPlaylists));this.D.smartDownloadedPlaylists&&
l.push.apply(l,g.N(this.D.smartDownloadedPlaylists));this.D.metadataOnlyTracks&&l.push.apply(l,g.N(this.D.metadataOnlyTracks));return[].concat(g.N(new Set(l)))};
g.P(UtQ,CT);UtQ.prototype.G=function(){var l=[];this.D.trackDownloadMetadatas&&l.push.apply(l,g.N(this.D.trackDownloadMetadatas));return[].concat(g.N(new Set(l)))};
g.P(GiQ,CT);GiQ.prototype.G=function(){var l=[];this.D.playbackData&&l.push(this.D.playbackData);this.D.localImageEntities&&l.push.apply(l,g.N(this.D.localImageEntities));this.D.videoDownloadContextEntity&&l.push(this.D.videoDownloadContextEntity);return[].concat(g.N(new Set(l)))};
g.P(fBL,CT);fBL.prototype.G=function(){var l=[];this.D.musicLibraryStatusEntity&&l.push(this.D.musicLibraryStatusEntity);this.D.primaryArtists&&l.push.apply(l,g.N(this.D.primaryArtists));this.D.details&&l.push(this.D.details);this.D.userDetails&&l.push(this.D.userDetails);this.D.tracks&&l.push.apply(l,g.N(this.D.tracks));this.D.share&&l.push(this.D.share);this.D.downloadMetadata&&l.push(this.D.downloadMetadata);this.D.refresh&&l.push(this.D.refresh);return[].concat(g.N(new Set(l)))};
g.P(PRe,CT);PRe.prototype.G=function(){var l=[];this.D.albumRelease&&l.push(this.D.albumRelease);this.D.tracks&&l.push.apply(l,g.N(this.D.tracks));return[].concat(g.N(new Set(l)))};
g.P(bIL,CT);bIL.prototype.G=function(){var l=[];this.D.albumRelease&&l.push(this.D.albumRelease);return[].concat(g.N(new Set(l)))};
g.P(qEQ,CT);qEQ.prototype.G=function(){var l=[];this.D.details&&l.push(this.D.details);this.D.userDetails&&l.push(this.D.userDetails);return[].concat(g.N(new Set(l)))};
g.P(aBa,CT);aBa.prototype.G=function(){var l=[];this.D.parentArtist&&l.push(this.D.parentArtist);return[].concat(g.N(new Set(l)))};
g.P(Nrc,CT);Nrc.prototype.G=function(){var l=[];this.D.parentArtist&&l.push(this.D.parentArtist);return[].concat(g.N(new Set(l)))};
g.P(pL7,CT);pL7.prototype.G=function(){return[]};
g.P(RTc,CT);RTc.prototype.G=function(){return[]};
g.P(iIF,oK);iIF.prototype.G=function(){var l=[];this.D.creatorEntity&&l.push(this.D.creatorEntity);return[].concat(g.N(new Set(l)))};
g.P(SEN,CT);
SEN.prototype.G=function(){var l=[];this.D.tracks&&l.push.apply(l,g.N(this.D.tracks));this.D.refresh&&l.push(this.D.refresh);this.D.musicLibraryStatusEntity&&l.push(this.D.musicLibraryStatusEntity);this.D.details&&l.push(this.D.details);this.D.downloadMetadata&&l.push(this.D.downloadMetadata);this.D.sideloadMetadata&&l.push(this.D.sideloadMetadata);this.D.userDetails&&l.push(this.D.userDetails);this.D.entryCollection&&l.push(this.D.entryCollection);this.D.share&&l.push(this.D.share);this.D.podcastShowAdditionalMetadata&&l.push.apply(l,
g.N((new iIF(this.D.podcastShowAdditionalMetadata)).G()));return[].concat(g.N(new Set(l)))};
g.P(vRN,CT);vRN.prototype.G=function(){return[]};
g.P(xtQ,CT);
xtQ.prototype.G=function(){var l=[];this.D.musicLibraryStatusEntity&&l.push(this.D.musicLibraryStatusEntity);this.D.artists&&l.push.apply(l,g.N(this.D.artists));this.D.audioModeVersion&&l.push(this.D.audioModeVersion);this.D.videoModeVersion&&l.push(this.D.videoModeVersion);this.D.userDetails&&l.push(this.D.userDetails);this.D.details&&l.push(this.D.details);this.D.albumRelease&&l.push(this.D.albumRelease);this.D.share&&l.push(this.D.share);this.D.libraryEdit&&l.push(this.D.libraryEdit);this.D.downloadMetadata&&
l.push(this.D.downloadMetadata);this.D.playbackPosition&&l.push(this.D.playbackPosition);this.D.lyrics&&l.push(this.D.lyrics);return[].concat(g.N(new Set(l)))};
g.P(zT7,CT);zT7.prototype.G=function(){var l=[];this.D.parentTrack&&l.push(this.D.parentTrack);return[].concat(g.N(new Set(l)))};
g.P(nRF,CT);nRF.prototype.G=function(){var l=[];this.D.parentTrack&&l.push(this.D.parentTrack);return[].concat(g.N(new Set(l)))};
g.P(hTa,CT);hTa.prototype.G=function(){return[]};
g.P(HIa,CT);HIa.prototype.G=function(){return[]};
g.P(wLL,CT);wLL.prototype.G=function(){return[]};
g.P(KIi,CT);KIi.prototype.G=function(){return[]};
g.P(TrN,CT);TrN.prototype.G=function(){var l=[];this.D.transfer&&l.push(this.D.transfer);this.D.adsPlaybackData&&l.push.apply(l,g.N(this.D.adsPlaybackData));this.D.drmLicense&&l.push(this.D.drmLicense);this.D.offlineVideoPolicy&&l.push(this.D.offlineVideoPolicy);this.D.videoDownloadContextEntity&&l.push(this.D.videoDownloadContextEntity);return[].concat(g.N(new Set(l)))};
g.P(jMc,CT);jMc.prototype.G=function(){return[]};
g.P(V2Q,CT);V2Q.prototype.G=function(){var l=[];this.D.offlineVideoStreams&&l.push.apply(l,g.N(this.D.offlineVideoStreams));this.D.captionTrack&&l.push.apply(l,g.N(this.D.captionTrack));return[].concat(g.N(new Set(l)))};
g.P(oRF,CT);oRF.prototype.G=function(){return[]};
g.P(CRE,CT);CRE.prototype.G=function(){return[]};
g.P(ZIV,CT);ZIV.prototype.G=function(){return[]};
g.P($tQ,CT);$tQ.prototype.G=function(){return[]};
g.P(QML,CT);QML.prototype.G=function(){return[]};
g.P(mtQ,CT);mtQ.prototype.G=function(){return[]};
g.P(WIQ,CT);WIQ.prototype.G=function(){return[]};
g.P(M2a,CT);M2a.prototype.G=function(){return[]};
g.P(sM6,CT);sM6.prototype.G=function(){return[]};
g.P(Brc,CT);Brc.prototype.G=function(){return[]};
g.P(LIU,CT);LIU.prototype.G=function(){return[]};
g.P(ERa,CT);ERa.prototype.G=function(){return[]};
g.P(gRe,CT);gRe.prototype.G=function(){return[]};
g.P(usa,CT);usa.prototype.G=function(){return[]};
g.P(AsL,CT);AsL.prototype.G=function(){return[]};
g.P(FIi,CT);FIi.prototype.G=function(){return[]};
g.P(IBN,CT);IBN.prototype.G=function(){return[]};
g.P(lDQ,CT);lDQ.prototype.G=function(){return[]};
g.P(czQ,CT);czQ.prototype.G=function(){return[]};
g.P(YsQ,CT);YsQ.prototype.G=function(){return[]};
var IZe=["browse","music/browse","unplugged/browse"],kbF=["offline/playlist_sync_check"],Mnc=["offline"],lJ6=["offline/offline_video_playback_position_sync"],YeE=["offline/get_playback_data_entity"],Z2;$d.getInstance=function(){return g.H(function(l){return l.return(new Promise(function(c){g.l1().then(function(Y){Y?($d.instance||($d.instance=new $d(Y)),c($d.instance)):c(void 0)})}))})};
$d.prototype.get=function(l){var c=this,Y,X,k;return g.H(function(r){if(r.D==1)return g.n(r,e6N(c.token),2);if(r.D!=3)return Y=r.G,g.n(r,Y.get("prefs",l),3);X=r.G;if(!X)return r.return();k=(0,g.nb)();return X.expirationTimestampMs<=k?r.return():r.return(X.value)})};
$d.prototype.set=function(l,c,Y){Y=Y===void 0?31536E3:Y;var X=this,k,r,e;return g.H(function(d){if(d.D==1)return k=(0,g.nb)(),r={key:l,value:c,expirationTimestampMs:k+Y*1E3},g.n(d,e6N(X.token),2);e=d.G;return g.n(d,g.Vg(e,"prefs",r),0)})};
$d.prototype.remove=function(l){var c=this,Y;return g.H(function(X){if(X.D==1)return g.n(X,e6N(c.token),2);Y=X.G;return g.n(X,Y.delete("prefs",l),0)})};
g.P(Q2,g.Ed);g.P(mO,Dee);mO.prototype.K=function(l,c){c=Ue7(c);l=(new TextEncoder).encode(JSON.stringify(l));return this.D.encrypt(l,c)};
mO.prototype.G=function(l,c){if(!(l instanceof Uint8Array))throw JzU(1);var Y=new TextDecoder;c=Ue7(c);l=this.D.decrypt(l,c);return JSON.parse(Y.decode(l))};
var GYi={accountLinkStatusEntity:haN,booleanEntity:N0a,buttonEntity:gRe,captionTrack:hTa,channelHandle:qUQ,commerceAcquisitionClientPayloadEntity:AsL,commerceCartListEntity:FIi,contextNoteFeedEntityPayload:arQ,continuationTokenEntity:spL,downloadQualityPickerEntity:T0L,downloadsPageRefreshTokenEntity:VHQ,downloadsPageViewConfigurationEntity:lBM,downloadStatusEntity:jpE,dismissState:WIQ,sfvAudioItemCurrentlyPlayingEntity:$tQ,emojiFountainDataEntity:LIU,emojiCustomizationSetEntity:Brc,fakeChannel:Raa,
fakePlaylist:iRV,fakePlaylistEntryCollection:vkN,fakeVideo:x6N,fakeVideoDescription:zaE,featuredProductsEntity:dti,flowStateEntity:nkM,iconBadgeEntity:IBN,interstitialInteractionStateEntity:wMa,likeButtonAnimationEntity:csM,liveChatPollStateEntity:KDi,liveViewerLeaderboardChatEntryPointStateEntity:CRE,liveViewerLeaderboardPointsEntity:ZIV,liveReactionsDataEntity:ERa,logoEntity:HRM,macroMarkerEntity:YE7,mainDownloadsLibraryEntity:ok6,mainDownloadsListEntity:ZRQ,mainPlaylistDownloadStateEntity:$6c,
mainPlaylistEntity:B07,mainPlaylistVideoEntity:LDV,mainVideoDownloadStateEntity:QpL,mainVideoEntity:AYQ,markersEngagementPanelSyncEntity:XLa,markersVisibilityOverrideEntity:kiN,musicAlbumReleaseDetail:PRe,musicAlbumReleaseDownloadMetadataEntity:DtU,musicAlbumRelease:fBL,musicAlbumReleaseUserDetail:bIL,musicArtistDetail:aBa,musicArtist:qEQ,musicArtistUserDetail:Nrc,musicDownloadsLibraryEntity:t2c,musicLibraryEdit:pL7,musicLibraryStatusEntity:RTc,musicPlaylist:SEN,musicPlaylistDownloadMetadataEntity:UtQ,
musicShare:vRN,musicTrackDetail:zT7,musicTrackDownloadMetadataEntity:GiQ,musicTrack:xtQ,musicTrackUserDetail:nRF,offlineOrchestrationActionWrapperEntity:HIa,offlineVideoPolicy:wLL,offlineVideoStreams:KIi,offlineabilityEntity:m6N,orchestrationWebSamplingEntity:WDU,pageHeaderEntity:M2a,pdpStateEntity:lDQ,pinnedProductEntity:ysQ,playbackData:TrN,playerStateEntity:rsN,quantityIncrementerEntity:czQ,refresh:jMc,saveToPlaylistListEntity:QML,settingEntity:mtQ,stringEntity:pMQ,suggestedFeedbackChipStateEntity:eTc,
transfer:V2Q,trendingOfferEntity:OI7,videoDownloadContextEntity:oRF,videoOverviewAsyncDataEntity:YsQ,videoPlaybackPositionEntity:usa,votingEntity:sM6,ytMainChannelEntity:FDe,youchatPendingResponseEntity:Js7,ytMainDownloadedVideoEntity:MHV,ytMainVideoEntity:Ire};g.P(Ek,Dee);Ek.prototype.K=function(l){return l};
Ek.prototype.G=function(l){if(l instanceof Uint8Array)throw JzU(0);return l};
g.P(gc,g.C);gc.prototype.observe=function(l){var c=this;this.observers.push(l);return function(){var Y=c.observers.indexOf(l);Y>=0&&c.observers.splice(Y,1)}};
gc.prototype.G=function(l){nKN(this,l.data)};
gc.prototype.Tz=function(){this.channel.close()};
var TgE,hjF=new g.zL("elementsCommand");var Sw=new g.zL("entityBatchUpdate");var bOU=new g.zL("downloadStatusEntity");var TRF=new g.zL("mainPlaylistEntityActionMetadata");var uD=new g.zL("mainVideoEntityActionMetadata");var W0i=new g.zL("musicPlaylistEntityActionMetadata");var GLF=new g.zL("musicTrackEntityActionMetadata");var gVc=new g.zL("localImageEntityActionMetadata");var VL=new g.zL("playbackDataActionMetadata");var HWF=new g.zL("transferEntityActionMetadata");var fJL=new g.zL("videoPlaybackPositionEntityActionMetadata");var gKF;new g.vb;new g.vb;lZE.prototype.request=function(l,c,Y){c=c===void 0?{}:c;return this.locks.request(l,c,function(X){return Y(X)})};var XI=g.Qn.caches,Yb,rT7;ct.prototype.open=function(l){return XI.open(XPE(l))};
ct.prototype.has=function(l){return XI.has(XPE(l))};
ct.prototype.delete=function(l){return XI.delete(XPE(l))};
ct.prototype.match=function(l,c){var Y=this,X,k,r,e,d,y;return g.H(function(O){switch(O.D){case 1:return g.n(O,Y.keys(),2);case 2:X=O.G,k=g.b(X),r=k.next();case 3:if(r.done){O.kT(5);break}e=r.value;return g.n(O,Y.open(e),6);case 6:return d=O.G,g.n(O,d.match(l,c),7);case 7:if(y=O.G)return O.return(y);r=k.next();O.kT(3);break;case 5:return O.return()}})};
g.P(Y2a,ct);Y2a.prototype.keys=function(){var l,c,Y,X,k,r,e,d,y;return g.H(function(O){if(O.D==1)return l=[],c=g.gF("CacheStorage keys"),g.n(O,XI.keys(),2);Y=O.G;X=g.b(Y);for(k=X.next();!k.done;k=X.next()){r=k.value;var D=r.indexOf(":");e=D===-1?{ym:r}:{ym:r.substring(0,D),datasyncId:r.substring(D+1)};d=e.ym;y=e.datasyncId;y===c&&l.push(d)}return O.return(l)})};g.P(rd,g.C);rd.prototype.K=function(l){this.api.cU("onOfflineOperationFailure",l.data)};
rd.prototype.T=function(l){this.api.publish("offlinetransferpause",l.data)};
rd.prototype.Tz=function(){var l;(l=this.D)==null||l.close();var c;(c=this.G)==null||c.close()};dF7.prototype.A5=function(){this.D&&JI(this)};
dF7.prototype.fg=function(){this.G&&this.G.resolve();this.K=this.D=!1;this.j()};var LSi=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var xFQ="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var CAe="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.P(efE,Kd);efE.prototype.G=function(l){return Ds(l)?yLi(this,l):tI(l)?tpe(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};g.P(UQN,Kd);UQN.prototype.G=function(l){return tI(l)?GbE(this,l):PAQ(l)?Pf6(this,l):UF(l)?bWV(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};g.J=qeN.prototype;g.J.ZCd=function(l){var c=this,Y,X,k,r;return g.H(function(e){if(!g.L(l.state,128))return e.kT(0);Y=l.state.j0;var d=(X=Y)==null?void 0:X.errorCode,y=(k=Y)==null?void 0:k.vt;r=d==="net.connect"&&y===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(d==null?0:d.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.n(e,c.wx(c.player.getVideoData().videoId,r),0)})};
g.J.wx=function(l,c){var Y=this;return g.H(function(X){if(X.D==1){if(Y.G)return X.return();Y.G=!0;return c==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Zs(Y,l,!1,!0),X.kT(0)):g.n(X,Cd(Y,l),3)}g.wa(l,4);return g.n(X,Y.D.wx(c),0)})};
g.J.JP=function(l){l.status===2?(l.status!==this.K&&(GDe(this.D),g.wa(l.videoId,2)),l.qo&&aKL(this.D,l.videoId,l.qo)):l.status===4?(Cd(this,l.videoId),this.wx(l.videoId,l.Ll?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):l.status===1&&qDa(this.D);this.K=l.status;this.api.cU("localmediachange",{videoId:l.videoId,status:l.status})};
g.J.pL=function(){var l=this,c;return g.H(function(Y){if(Y.D==1){if(l.G)return Y.return();l.G=!0;c=l.player.getVideoData().videoId;return g.n(Y,Cd(l,c),2)}return g.n(Y,l.D.pL(),0)})};
g.J.Nb=function(l){switch(l){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.J.B=function(l){return this.api.L().B(l)};g.P(vUi,Kd);vUi.prototype.G=function(l){return Ds(l)?zfE(this,l):tI(l)?nUN(this,l):PAQ(l)?hfU(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};VpU.prototype.D=function(l,c){var Y=l.action.actionMetadata.priority-c.action.actionMetadata.priority;Y===0&&(l.D<c.D?Y=-1:l.D>c.D&&(Y=1));return Y};g.P($b,g.C);$b.prototype.Tz=function(){this.j&&this.j();g.C.prototype.Tz.call(this)};
$b.prototype.createAction=function(l,c){var Y=g.FN(l.entityKey).entityType,X=g.vw(16);return new qY(Y,X,l,c.actionId,c.rootActionId)};
$b.prototype.Kh=function(l){var c=this,Y,X,k,r,e,d,y,O,D;return g.H(function(t){if(t.D==1){if(c.vU())return t.return();X=(Y=l.offlineOrchestrationActionWrapperEntity)!=null?Y:new Set;k=[];r=g.b(X);for(e=r.next();!e.done;e=r.next())d=e.value,y=g.FN(d),O=y.entityId,ZWa(c.D,O)||k.push(d);return g.n(t,uYQ(c,k),2)}D=t.G;return g.n(t,gUM(c,D),0)})};
$b.prototype.retry=function(){var l=this;return g.H(function(c){return g.n(c,ALU(l),0)})};IJL.prototype.YA=function(l,c){c=c===void 0?!0:c;var Y=this,X,k,r,e,d,y,O,D;return g.H(function(t){switch(t.D){case 1:if(!Y.D)return t.return();X=[];k=g.c1(Y.D.G,c);r=[];for(e={eg:0};e.eg<k.length;e={eg:e.eg},e.eg++)d=k[e.eg],y=Y.D.KD(d,"json3"),O=g.HU(y,{withCredentials:!0,format:"RAW"},3,500).then(function(U){return function(G){G={metadata:g.PZ(k[U.eg]),trackData:G.xhr.responseText};r.push(G)}}(e)).Kx(function(U){kb("Caption fetch error",U)}),X.push(O);
return g.n(t,bRN(X),2);case 2:return g.Rn(t,3),g.n(t,meL(l,r),5);case 5:g.Si(t,0);break;case 3:D=g.vS(t),kb("Caption DB transaction error",D),g.pL(t)}})};g.P(QL,g.C);QL.prototype.Tz=function(){this.G&&this.G();g.C.prototype.Tz.call(this)};
QL.prototype.K=function(l){var c=this,Y,X,k,r,e,d,y,O;return g.H(function(D){X=(Y=l.transfer)!=null?Y:new Set;k=[];r=g.b(X);for(e=r.next();!e.done;e=r.next())d=e.value,y=g.FN(d),O=y.entityId,k.push(O);return k.length===0?D.return():g.n(D,YDV(c,k),0)})};g.P(Jj6,g.C);g.J=Jj6.prototype;g.J.Tz=function(){this.xT&&this.xT();this.JJ.dispose();this.T.dispose();this.NQ&&g.AG(this.W.U3,this.NQ);this.Ch&&g.AG(this.W.U3,this.Ch);g.C.prototype.Tz.call(this)};
g.J.t00=function(l){var c=this,Y,X,k;return g.H(function(r){switch(r.D){case 1:Y=g.I5(l,"transfer");if(c.D&&Y===c.D.key){Zs(c.C,c.N,!0);c.T.stop();r.kT(0);break}return g.n(r,uK(c.G,{mode:"readwrite",b9:!0},function(e){return W$(e,Y,"transfer").then(function(d){if(d&&d.transferState!=="TRANSFER_STATE_COMPLETE"&&d.transferState!=="TRANSFER_STATE_FAILED")return d.transferState="TRANSFER_STATE_PAUSED_BY_USER",B$(e,d,"transfer").then(function(){return d})})}),3);
case 3:X=r.G;if(!X){r.kT(0);break}if(!l||!c.K){r.kT(5);break}return g.n(r,Gr(l,c.K,c.G,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.n(r,MY(c,l),7);case 7:k=r.G,GsL({videoId:l,kS:X,offlineModeType:k}),g.pL(r)}})};
g.J.KNh=function(){var l=this;if(this.D&&this.N){Zs(this.C,this.N,!1);var c=this.D,Y=(c==null?0:c.key)?g.FN(c.key).entityId:"";Y&&this.K&&(new Promise(function(X,k){Gr(Y,l.K,l.G,"DOWNLOAD_STATE_PAUSED").catch(function(r){k(r)})})).catch(function(X){kb("Download state setting error",X)})}this.T.stop()};
g.J.DI=function(){this.D?O6Q(this,this.D):Wt(this)};
g.J.BQ=function(l){var c=this;return g.H(function(Y){switch(Y.D){case 1:if(!c.D){Y.kT(2);break}if(c.D.transferState==="TRANSFER_STATE_COMPLETE"||c.D.transferState==="TRANSFER_STATE_FAILED"||!l.transfer||!l.transfer.has(c.D.key)){Y.kT(3);break}return g.n(Y,FV(c.G,c.D.key,"transfer"),4);case 4:c.D=Y.G;if(c.D){Y.kT(3);break}return g.n(Y,DwL(c),3);case 3:if(c.D)return Y.return();case 2:return g.n(Y,Wt(c),0)}})};
g.J.wx=function(l,c){var Y=this,X,k,r,e,d;return g.H(function(y){switch(y.D){case 1:if(!Y.D){sF(Y,"onTransferFailure: "+l);y.kT(2);break}X=Y.D;r=((k=X)==null?0:k.key)?g.FN(X.key).entityId:"";a:switch(l){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var O=!1;break a;default:O=!0}return O&&NRi(Y)?g.n(y,Bt(Y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.n(y,
pTc(Y,l),5);case 5:if(!r||!Y.K){y.kT(2);break}return g.n(y,Gr(r,Y.K,Y.G,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.n(y,MY(Y,r),9);case 9:e=y.G;yL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:r,kS:X,offlineModeType:e});if(!r||!Y.K){y.kT(2);break}return g.n(y,Gr(r,Y.K,Y.G,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:mR(Y),d=Wt(Y,!0),c&&c(d),g.pL(y)}})};
g.J.pL=function(l){var c=this,Y,X,k,r,e,d,y,O,D,t,U,G;return g.H(function(f){switch(f.D){case 1:if(!c.D){sF(c,"onMaybeTransferStreamsExpired");f.kT(2);break}return NRi(c)?g.n(f,Bt(c,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.n(f,pTc(c,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!c.K){f.kT(2);break}Y=c.D;k=((X=Y)==null?0:X.key)?g.FN(Y.key).entityId:"";if(!k){f.kT(2);break}return g.n(f,Gr(k,c.K,c.G,"DOWNLOAD_STATE_FAILED"),2);case 9:return c.D||sF(c,"onMaybeTransferStreamsExpiredRetryAttempting"),
r=c.D,d=((e=r)==null?0:e.key)?g.FN(r.key).entityId:"",g.n(f,MY(c,d),10);case 10:return y=f.G,yL({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:d,kS:r,offlineModeType:y}),O=NnE(),g.WR(O,VL,{isEnqueuedForExpiredStreamUrlRefetch:!0}),D=g.I5(d,"playbackData"),t={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:D,actionMetadata:O},U=NY(new qY("playbackData",d,t)),g.n(f,AK(c.G,U,"offlineOrchestrationActionWrapperEntity"),2);case 2:mR(c),G=Wt(c,!0),
l&&l(G),g.pL(f)}})};
var vFQ={},ROi=(vFQ.TRANSFER_STATE_TRANSFERRING=1,vFQ.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,vFQ);g.J=Ld.prototype;g.J.dQ=function(){return this.N.promise};
g.J.DD=function(){if(this.G&&this.C)return this.N.promise;vV6(this).then(this.N.resolve).catch(this.N.reject);return this.N.promise};
g.J.LN=function(l){var c={};return c.playbackData=new efE(l,this.fh,this.D),c.transfer=new vUi(l,this.fh),c.videoPlaybackPositionEntity=new UQN(l,this.fh),c};
g.J.PT=function(){var l=this;return g.H(function(c){return l.G?g.n(c,dwF(l.G),0):c.kT(0)})};
g.J.Q7=function(){var l=this,c,Y;return g.H(function(X){if(X.D==1)return l.G||l.C?g.n(X,l.dQ(),2):X.return();l.U!==void 0&&(g.av(l.U),l.U=void 0);l.T!==void 0&&(g.av(l.T),l.T=void 0);(c=l.G)==null||c.dispose();l.G=void 0;(Y=l.C)==null||Y.dispose();l.C=void 0;l.api.cU("onOrchestrationLostLeader");l.N=new g.vb;g.pL(X)})};
g.J.isOrchestrationLeader=function(){return this.K.D};
g.J.QZ=function(){return g.H(function(l){return l.return(!1)})};
g.J.Fm=function(l){var c=this.D;c.api.publish("offlinetransferpause",l);var Y;(Y=c.G)==null||Y.postMessage(l)};
g.J.DI=function(l){var c,Y;return g.H(function(X){if(X.D==1)return g.n(X,lD(),2);c=X.G;if(!c)return X.return();Y=g.I5(l,"transfer");return g.n(X,uK(c,{mode:"readwrite",b9:!0},function(k){var r=W$(k,Y,"transfer"),e=W$(k,g.I5(l,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.SI.all([r,e]).then(function(d){d=g.b(d);var y=d.next().value;var O=d.next().value;return y&&y.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(y.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",B$(k,y,"transfer").then(function(){yL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:l,kS:y,offlineModeType:O==null?void 0:O.offlineModeType});return g.SI.resolve(null)})):g.SI.resolve(null)})}),0)})};
g.J.RT=function(l){l=l===void 0?43200:l;var c=this,Y,X,k,r,e,d,y,O;return g.H(function(D){if(D.D==1)return c.W.Hp()?g.n(D,lD(),2):D.return(xw6());if(D.D!=3){Y=D.G;if(!Y)return D.return([]);X=Date.now()/1E3;return g.n(D,IK(Y,"offlineVideoPolicy"),3)}k=D.G;r=[];e=g.b(k);for(d=e.next();!d.done;d=e.next())y=d.value,Number(y.lastUpdatedTimestampSeconds)+l<=X&&(O=g.FN(y.key).entityId,r.push(O));return r.length?D.return(EF(c,r,c.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):D.return([])})};
g.J.deleteAll=function(){return EF(this,["!*$_ALL_ENTITIES_!*$"],this.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.J.refreshAllStaleEntities=function(l){var c=this;return g.H(function(Y){return Y.D==1?g.n(Y,c.RT(l),2):Y.return(Y.G)})};
g.J.setUpPositionSyncInterval=function(l){var c=this;this.T!==void 0&&(g.av(this.T),this.T=void 0);var Y=l!=null?l:864E5;this.T=g.ba(function(){c.YV(Y)},Y)};
g.J.YV=function(l){var c=this,Y,X,k,r,e,d;return g.H(function(y){switch(y.D){case 1:return g.Rn(y,2),g.n(y,$d.getInstance(),4);case 4:Y=y.G;if(!Y)throw Error("prefStorage is undefined");return g.n(y,Y.get("psi"),5);case 5:X=y.G;r=((k=X)==null?0:k.iW)?Number(X.iW)/1E3:0;e=Date.now();if(!(r+l<=e)){y.kT(6);break}return g.n(y,EF(c,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Si(y,0);break;case 2:d=g.vS(y),kb("Offline manager error",d),
g.pL(y)}})};
g.J.xs=function(){var l=this,c,Y,X,k,r,e,d;return g.H(function(y){if(y.D==1)return g.n(y,lD(),2);if(y.D!=3)return(c=y.G)?g.n(y,IK(c,"transfer"),3):y.return([]);Y=y.G;X=[];k=g.b(Y);for(r=k.next();!r.done;r=k.next())e=r.value,e.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&e.key&&(d=g.FN(e.key).entityId,X.push(d));return y.return(nVM(l,X))})};
g.J.K7=function(){return g.H(function(l){return l.return([])})};
g.J.tR=function(){return g.H(function(l){g.pL(l)})};
g.J.lT=function(){return g.H(function(l){g.pL(l)})};g.P(hOF,Kd);hOF.prototype.G=function(l){return Ds(l)?KCi(this,l):tI(l)?jJV(this,l):UF(l)?VqQ(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var gd=[10];g.P(QJN,Kd);QJN.prototype.G=function(l){return Ds(l)?MqQ(this,l):tI(l)?sJc(this,l):UF(l)?BRN(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var WCi=[10];g.P(EVe,Kd);EVe.prototype.G=function(l){return tI(l)?uO6(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};g.P(AjQ,Ld);g.J=AjQ.prototype;g.J.LN=function(l){var c=Ld.prototype.LN.call(this,l);c.mainVideoEntity=new QJN(l,this.fh,this.D);c.mainPlaylistEntity=new hOF(l,this.fh,this.D);c.mainDownloadsListEntity=new EVe(l,this.fh,this.D);return c};
g.J.refreshAllStaleEntities=function(l,c){var Y=this,X,k,r,e,d,y,O,D,t,U,G;return g.H(function(f){switch(f.D){case 1:X=[];if(!Y.fh.B("web_player_offline_playlist_auto_refresh")){f.kT(2);break}return g.n(f,FCN(Y,l,c),3);case 3:X=f.G;case 2:return g.n(f,$d.getInstance(),4);case 4:return k=f.G,g.n(f,(r=k)==null?void 0:r.get("sdois"),5);case 5:return e=f.G,g.n(f,(d=k)==null?void 0:d.get("lmqf"),6);case 6:y=f.G;if(!e){f.kT(7);break}D=X;t=D.concat;return g.n(f,IK6(Y,e,(O=y)!=null?O:"SD",l===0),8);case 8:X=
t.call(D,f.G);case 7:return U=X,G=U.concat,g.n(f,Ld.prototype.refreshAllStaleEntities.call(Y,l,c),9);case 9:return X=G.call(U,f.G),f.return(X)}})};
g.J.QZ=function(l){var c,Y,X,k,r,e,d,y;return g.H(function(O){if(O.D==1)return g.n(O,lD(),2);if(O.D!=3)return(c=O.G)?g.n(O,FV(c,g.KK,"mainDownloadsListEntity"),3):O.return(!1);Y=O.G;if((X=Y)==null?0:(k=X.downloads)==null?0:k.length)for(r=g.I5(l,"mainVideoEntity"),e=g.b(Y.downloads),d=e.next();!d.done;d=e.next())if(y=d.value,y.videoItem===r)return O.return(!0);return O.return(!1)})};
g.J.K7=function(){var l=this,c,Y,X,k,r,e,d,y;return g.H(function(O){if(O.D==1)return g.n(O,lD(),2);if(O.D!=3)return(c=O.G)?g.n(O,IK(c,"downloadStatusEntity"),3):O.return([]);Y=O.G;X=[];k=g.b(Y);for(r=k.next();!r.done;r=k.next())e=r.value,e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&e.key&&(d=g.FN(e.key).entityId,X.push(d));return X.length?(y={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},O.return(EF(l,X,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
y))):O.return([])})};
g.J.lT=function(){var l;return g.H(function(c){return c.D==1?g.n(c,lD(),2):(l=c.G)?g.n(c,uK(l,{mode:"readwrite",b9:!0},function(Y){return Mv(Y,"mainVideoEntity").then(function(X){var k=[];X=g.b(X);for(var r=X.next();!r.done;r=X.next()){r=r.value;var e=void 0;(e=r.userState)!=null&&e.playbackPosition||(e=g.FN(r.key).entityId,e={key:g.I5(e,"videoPlaybackPositionEntity"),videoId:e,lastPlaybackPositionSeconds:"0"},k.push(B$(Y,e,"videoPlaybackPositionEntity")),r.userState={playbackPosition:e.key},k.push(B$(Y,
r,"mainVideoEntity")))}return g.SI.all(k)})}),0):c.return()})};
g.J.tR=function(){var l,c,Y,X,k,r,e,d,y,O,D,t,U,G,f,a,p,S,x,h,K,Q,lc,E,kv,Jg,I,W,F,q,M,mK,SL,PV,zO,lQ,JE,qN;return g.H(function(R){if(R.D==1)return g.n(R,lD(),2);if(R.D!=3){l=R.G;if(!l)return R.return();c=g.I5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.n(R,uK(l,{mode:"readonly",b9:!0},function(v){return g.SI.all([W$(v,c,"mainDownloadsListEntity"),W$(v,g.KK,"mainDownloadsListEntity"),Mv(v,"mainVideoEntity"),Mv(v,"mainPlaylistEntity")])}),3)}Y=R.G;
X=g.b(Y);k=X.next().value;r=X.next().value;e=X.next().value;d=X.next().value;y=k;O=r;D=e;t=d;U=new Set;if((G=y)==null?0:(f=G.downloads)==null?0:f.length)for(a=g.b(y.downloads),p=a.next();!p.done;p=a.next())S=p.value,x=void 0,(h=(x=S.videoItem)!=null?x:S.playlistItem)&&U.add(h);if((K=O)==null?0:(Q=K.downloads)==null?0:Q.length)for(lc=g.b(O.downloads),E=lc.next();!E.done;E=lc.next())kv=E.value,kv.videoItem&&U.add(kv.videoItem);Jg=new Set;I=[];W=g.b(t);for(F=W.next();!F.done;F=W.next()){q=F.value;if(q.videos)for(M=
g.b(q.videos),mK=M.next();!mK.done;mK=M.next())SL=mK.value,(PV=JSON.parse(g.FN(SL).entityId).videoId)&&Jg.add(PV);q.key&&!U.has(q.key)&&I.push(q.key)}zO=g.b(D);for(lQ=zO.next();!lQ.done;lQ=zO.next())JE=lQ.value,JE.key&&!U.has(JE.key)&&(qN=g.FN(JE.key).entityId,Jg.has(qN)||I.push(JE.key));return I.length?g.n(R,TnN(l,I),0):R.kT(0)})};g.P(lYc,Kd);lYc.prototype.G=function(l){return Ds(l)?YSe(this,l):tI(l)?Xpc(this,l):UF(l)?kLU(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var AI=[10];g.P(et6,Kd);et6.prototype.G=function(l){return Ds(l)?dmc(this,l):tI(l)?yJa(this,l):UF(l)?OnF(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var FI=[10];g.P(UmQ,Kd);UmQ.prototype.G=function(l){return Ds(l)?bn6(this,l):tI(l)?qSN(this,l):UF(l)?aYQ(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var Ph7=[10];g.P(Ir,Ld);Ir.prototype.LN=function(l){var c=Ld.prototype.LN.call(this,l);c.musicTrack=new UmQ(l,this.D);c.musicPlaylist=new et6(l,this.D);c.musicAlbumRelease=new lYc(l,this.D);return c};
Ir.prototype.refreshAllStaleEntities=function(l,c){var Y=this,X,k,r;return g.H(function(e){if(e.D==1)return g.n(e,ppa(Y,l,c),2);if(e.D!=3)return k=X=e.G,r=k.concat,g.n(e,Ld.prototype.refreshAllStaleEntities.call(Y,l,c),3);X=r.call(k,e.G);return e.return(X)})};g.P(Rtc,g.GH);g.J=Rtc.prototype;g.J.create=function(){var l=this;g.Z(this,this.events);g.A2(this.fh)?this.D=new AjQ(this.fh,this.player):g.Zq(this.fh)&&(this.D=new Ir(this.fh,this.player));this.events.Z(this.player,"onPlaybackStartExternal",function(){l.dc()});
this.events.Z(this.player,"videodatachange",function(){l.dc()});
this.fh.B("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.Ku)};
g.J.Pn=function(){return!1};
g.J.oF=function(l,c,Y,X){var k=this;return g.H(function(r){return k.D?r.return(EF(k.D,l,c,Y,X)):r.return(Promise.reject())})};
g.J.deleteAll=function(){return this.D.deleteAll()};
g.J.RT=function(l){return this.D.RT(l)};
g.J.refreshAllStaleEntities=function(l){return this.D.refreshAllStaleEntities(l)};
g.J.setUpPositionSyncInterval=function(l){this.D.setUpPositionSyncInterval(l)};
g.J.Fm=function(l){this.D.Fm(l)};
g.J.DI=function(l){return this.D.DI(l)};
g.J.dc=function(){var l=this,c;return g.H(function(Y){c=l.player.getVideoData();return g.Eg(c)?inN(c)&&l.G!==c.clientPlaybackNonce?g.n(Y,SSc(l,c),0):Y.kT(0):Y.return()})};
g.J.Ku=function(l){var c=this,Y,X,k,r,e,d,y;return g.H(function(O){if(O.D==1)return Y=c.player.getVideoData(),X=Y.nh,g.PE(l,2)||g.PE(l,512)?g.n(O,lD(),2):O.return();if(O.D!=3){k=O.G;if(!k)return kb("PES is undefined"),O.return();r=Y.videoId;return g.n(O,FV(k,g.I5(r,"mainVideoEntity"),"mainVideoEntity"),3)}e=O.G;if(!e)return O.return();d=Math.floor(X).toString();y={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:d}};return g.n(O,c.oF([r],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
y),0)})};
g.J.isOrchestrationLeader=function(){return this.D.isOrchestrationLeader()};
g.J.updateDownloadState=function(l,c){var Y,X,k,r;return g.H(function(e){if(e.D==1)return g.n(e,lD(),2);Y=e.G;if(!Y)return kb("PES is undefined"),e.return();X=g.FN(l);k=X.entityType;r=X.entityId;return g.n(e,Gr(r,k,Y,c,!0),0)})};g.U$("offline",Rtc);})(_yt_player);
